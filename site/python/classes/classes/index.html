<!doctype html>
<html lang="en">

<head>
        <title>Classes - My Docs</title>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        
        
        

        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
        <link rel="stylesheet" href="../../../assets/css/bootstrap.min.css">
        <link rel="stylesheet" href="../../../assets/css/dracula-ui.css">
        <link rel="stylesheet" href="../../../assets/css/mkdocs.css">

        
            <link  rel="icon" type="image/x-icon" href="../../../assets/img/favicon.ico">
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
                <script>hljs.initHighlightingOnLoad();</script>

</head>

<body class="drac-bg-black-secondary drac-text-grey-ternary drac-text drac-scrollbar-purple">

    <main class="d-flex">

        <!-- block sidebar -->
            <nav id="sidebar" class="sidebar drac-bg-black">
    <div class="custom-menu">
        <button type="button" id="sidebarCollapse" class="btn btn-primary">
            <i class="fa fa-bars"></i>
            <span class="sr-only">Menu</span>
        </button>
    </div>

    <div class="p-4">
        

        <div class="drac-text-center">
            
                <span class="drac-text drac-line-height drac-text-white">My Docs</span>
            
        </div>

        <div class="drac-box flex-column">
            <ul class="dot-ul">
                <li><div class="dot-li drac-bg-cyan"></div></li>
                <li><div class="dot-li drac-bg-green"></div></li>
                <li><div class="dot-li drac-bg-orange"></div></li>
                <li><div class="dot-li drac-bg-pink"></div></li>
                <li><div class="dot-li drac-bg-purple"></div></li>
                <li><div class="dot-li drac-bg-red"></div></li>
                <li><div class="dot-li drac-bg-yellow"></div></li>
            </ul>
        </div>

        <hr class="drac-divider" />

        <!-- block menu -->
        <ul class="mb-5 drac-list drac-list-none">
            
            <li class="drac-box">
                <a href="../../.."
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    Home
                </a>
            </li>
            <li class="drac-box">
                <a href="../../.."
                    class="
                    drac-anchor btn-toggle d-inline-flex align-items-center border-0 drac-text-purple--hover collapsed"
                    data-bs-toggle="collapse" data-bs-target="#gitlab-collapse" aria-expanded="false">
                    Gitlab
                </a>
                <div class="collapse" id="gitlab-collapse">
                    <ul class="mb-5 drac-list drac-list-none">
                            
    <li class="drac-box-ternary">
        <a href="../../../gitlab/install/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Install
        </a>
    </li>
                    </ul>
                </div>
            </li>
            <li class="drac-box">
                <a href="../../.."
                    class="
                    drac-anchor btn-toggle d-inline-flex align-items-center border-0 drac-text-purple--hover collapsed"
                    data-bs-toggle="collapse" data-bs-target="#kubernetes-collapse" aria-expanded="false">
                    Kubernetes
                </a>
                <div class="collapse" id="kubernetes-collapse">
                    <ul class="mb-5 drac-list drac-list-none">
                            
    <li class="drac-box-ternary">
        <a href="../../../kubernetes/architecture/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Architecture
        </a>
    </li>
                            
    <li class="drac-box-ternary">
        <a href="../../../kubernetes/backup/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Backup
        </a>
    </li>
                            
    <li class="drac-box-ternary">
        <a href="../../../kubernetes/deployments/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Deployments
        </a>
    </li>
                            
    <li class="drac-box-ternary">
        <a href="../../../kubernetes/image-security/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Image Security
        </a>
    </li>
                            
    <li class="drac-box-ternary">
        <a href="../../../kubernetes/lifecycle/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Lifecycle
        </a>
    </li>
                            
    <li class="drac-box-ternary">
        <a href="../../../kubernetes/maintanence/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Maintenance
        </a>
    </li>
                            
    <li class="drac-box-ternary">
        <a href="../../../kubernetes/monitoring/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Monitoring
        </a>
    </li>
                            
    <li class="drac-box-ternary">
        <a href="../../../kubernetes/namespaces/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Namespaces
        </a>
    </li>
                            
    <li class="drac-box-ternary">
        <a href="../../../kubernetes/newtwork/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Network
        </a>
    </li>
                            
    <li class="drac-box-ternary">
        <a href="../../../kubernetes/pods/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Pods
        </a>
    </li>
                            
    <li class="drac-box-ternary">
        <a href="../../../kubernetes/replicasets/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            ReplicaSets
        </a>
    </li>
                            
    <li class="drac-box-ternary">
        <a href="../../../kubernetes/roles/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Roles
        </a>
    </li>
                            
    <li class="drac-box-ternary">
        <a href="../../../kubernetes/security/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Security
        </a>
    </li>
                            
    <li class="drac-box-ternary">
        <a href="../../../kubernetes/services/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Services
        </a>
    </li>
                            
    <li class="drac-box-ternary">
        <a href="../../../kubernetes/sheduler/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Scheduler
        </a>
    </li>
                    </ul>
                </div>
            </li>
            <li class="drac-box">
                <a href="../../.."
                    class="
                    drac-anchor btn-toggle d-inline-flex align-items-center border-0 drac-text-purple--hover collapsed"
                    data-bs-toggle="collapse" data-bs-target="#programming-collapse" aria-expanded="false">
                    Programming
                </a>
                <div class="collapse" id="programming-collapse">
                    <ul class="mb-5 drac-list drac-list-none">
                            
    <li class="drac-box-ternary">
        <a href="../../../programming/code_review/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Code Review
        </a>
    </li>
                    </ul>
                </div>
            </li>
            <li class="drac-box">
                <a href="../../.."
                    class=" active 
                    drac-anchor btn-toggle d-inline-flex align-items-center border-0 drac-text-purple--hover collapsed"
                    data-bs-toggle="collapse" data-bs-target="#python-collapse" aria-expanded="false">
                    Python
                </a>
                <div class="collapse" id="python-collapse">
                    <ul class="mb-5 drac-list drac-list-none">
                            
    <li class="drac-box-ternary">
        <a href="#" class="
            drac-anchor-secondary btn-toggle d-inline-flex align-items-center border-0 drac-text-purple--hover collapsed"
            data-bs-toggle="collapse" data-bs-target="#classes-collapse" aria-expanded="false">
            Classes
        </a>

        <div class="collapse" id="classes-collapse">
            <ul class="mb-5 drac-list drac-list-none">
                    
    <li class="drac-box-ternary">
        <a href="./"
            class=" active 
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Classes
        </a>
    </li>
                    
    <li class="drac-box-ternary">
        <a href="../data_model/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Data Model
        </a>
    </li>
                    
    <li class="drac-box-ternary">
        <a href="../descriptors/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Descriptors
        </a>
    </li>
                    
    <li class="drac-box-ternary">
        <a href="../iterators/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Iterators
        </a>
    </li>
            </ul>
        </div>
    </li>
                            
    <li class="drac-box-ternary">
        <a href="#" class="
            drac-anchor-secondary btn-toggle d-inline-flex align-items-center border-0 drac-text-purple--hover collapsed"
            data-bs-toggle="collapse" data-bs-target="#context-managers-collapse" aria-expanded="false">
            Context Managers
        </a>

        <div class="collapse" id="context-managers-collapse">
            <ul class="mb-5 drac-list drac-list-none">
                    
    <li class="drac-box-ternary">
        <a href="../../context_managers/context_managers/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Context Managers
        </a>
    </li>
            </ul>
        </div>
    </li>
                            
    <li class="drac-box-ternary">
        <a href="#" class="
            drac-anchor-secondary btn-toggle d-inline-flex align-items-center border-0 drac-text-purple--hover collapsed"
            data-bs-toggle="collapse" data-bs-target="#data-types-collapse" aria-expanded="false">
            Data Types
        </a>

        <div class="collapse" id="data-types-collapse">
            <ul class="mb-5 drac-list drac-list-none">
                    
    <li class="drac-box-ternary">
        <a href="../../data_types/data_types/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Data Types
        </a>
    </li>
                    
    <li class="drac-box-ternary">
        <a href="../../data_types/dic_set/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Dic Set
        </a>
    </li>
                    
    <li class="drac-box-ternary">
        <a href="../../data_types/list_tuple/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            List Tuple
        </a>
    </li>
                    
    <li class="drac-box-ternary">
        <a href="../../data_types/object/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Object
        </a>
    </li>
            </ul>
        </div>
    </li>
                            
    <li class="drac-box-ternary">
        <a href="#" class="
            drac-anchor-secondary btn-toggle d-inline-flex align-items-center border-0 drac-text-purple--hover collapsed"
            data-bs-toggle="collapse" data-bs-target="#decorators-collapse" aria-expanded="false">
            Decorators
        </a>

        <div class="collapse" id="decorators-collapse">
            <ul class="mb-5 drac-list drac-list-none">
                    
    <li class="drac-box-ternary">
        <a href="../../decorators/decorators/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Decorators
        </a>
    </li>
            </ul>
        </div>
    </li>
                            
    <li class="drac-box-ternary">
        <a href="#" class="
            drac-anchor-secondary btn-toggle d-inline-flex align-items-center border-0 drac-text-purple--hover collapsed"
            data-bs-toggle="collapse" data-bs-target="#functions-collapse" aria-expanded="false">
            Functions
        </a>

        <div class="collapse" id="functions-collapse">
            <ul class="mb-5 drac-list drac-list-none">
                    
    <li class="drac-box-ternary">
        <a href="../../functions/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Index
        </a>
    </li>
            </ul>
        </div>
    </li>
                            
    <li class="drac-box-ternary">
        <a href="#" class="
            drac-anchor-secondary btn-toggle d-inline-flex align-items-center border-0 drac-text-purple--hover collapsed"
            data-bs-toggle="collapse" data-bs-target="#modules-collapse" aria-expanded="false">
            Modules
        </a>

        <div class="collapse" id="modules-collapse">
            <ul class="mb-5 drac-list drac-list-none">
                    
    <li class="drac-box-ternary">
        <a href="../../modules/builtins/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Builtins
        </a>
    </li>
                    
    <li class="drac-box-ternary">
        <a href="../../modules/io/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            IO
        </a>
    </li>
                    
    <li class="drac-box-ternary">
        <a href="../../modules/modules/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Modules
        </a>
    </li>
            </ul>
        </div>
    </li>
                            
    <li class="drac-box-ternary">
        <a href="#" class="
            drac-anchor-secondary btn-toggle d-inline-flex align-items-center border-0 drac-text-purple--hover collapsed"
            data-bs-toggle="collapse" data-bs-target="#structure-collapse" aria-expanded="false">
            Structure
        </a>

        <div class="collapse" id="structure-collapse">
            <ul class="mb-5 drac-list drac-list-none">
                    
    <li class="drac-box-ternary">
        <a href="../../structure/code_design/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Code Design
        </a>
    </li>
                    
    <li class="drac-box-ternary">
        <a href="../../structure/dessign_patterns/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Design Patterns
        </a>
    </li>
                    
    <li class="drac-box-ternary">
        <a href="../../structure/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Index
        </a>
    </li>
                    
    <li class="drac-box-ternary">
        <a href="../../structure/practices/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Practices
        </a>
    </li>
                    
    <li class="drac-box-ternary">
        <a href="../../structure/solid/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            SOLID
        </a>
    </li>
                    
    <li class="drac-box-ternary">
        <a href="../../structure/structure/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Structure
        </a>
    </li>
            </ul>
        </div>
    </li>
                    </ul>
                </div>
            </li>
        </ul>
        <!-- endblock -->
    </div>
</nav>
        <!-- endblock -->

        <nav class="divider drac-bg-purple-cyan"></nav>

        <div class="content">
            <!-- block header -->
                <header>
    <nav class="navbar navbar-expand-xl drac-bg-purple"">
        <div class="container-fluid">

            <!-- <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsMenu"
                aria-controls="navbarsMenu" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button> -->

            <div class="collapse navbar-collapse flex-column ml-auto" id="navbarsMenu">
                <ul class="navbar-nav">

                    <!-- block preview -->
                    <li class="nav-item">
                            
        <div class="container">
            <div class="row row-preview">
                <div class="col">
                    <a href="../../../programming/code_review/"
                        class="btn-preview drac-btn drac-btn-outline drac-text-white drac-text-cyan-green--hover">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </div>
                <div class="col">
                    <a href="../data_model/"
                        class="btn-preview drac-btn drac-btn-outline drac-text-white drac-text-cyan-green--hover" style="padding-left: 3%;">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>
                    </li>
                    <!--  endblock -->

                    <!-- block search -->
                    <li class="nav-item"><div role="search" class="search-box">
	<form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
		<input type="text" name="q" class="drac-input drac-input-search drac-input-white drac-text-white drac-bg-black-secondary"
		placeholder="Search docs" title="Type search term here" />
	</form>
</div>
                    </li>
                    <!--  endblock -->

                    <!-- block source -->
                    <li class="nav-item">
                        
                    </li>
                    <!--  endblock -->

                </ul>
            </div>

        </div>
    </nav>
</header>
            <!-- endblock -->

            <!-- block content -->
                <section class="p-md-5 section-content">
    <article>
        <p><h1 id="much-about-classes-and-object-oriented-programming">Much about Classes and Object Oriented Programming</h1>
<p>Classes are used to create new kinds of objects.</p>
<h2 id="classes-example">Classes Example</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="k">class</span> <span class="nc">AccountPortfolio</span><span class="p">:</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>    <span class="k">def</span> <span class="nf">add_account</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account</span><span class="p">):</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">account</span><span class="p">)</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>    <span class="k">def</span> <span class="nf">total_funds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">account</span><span class="o">.</span><span class="n">inquiry</span><span class="p">()</span> <span class="k">for</span> <span class="n">account</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="p">)</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="p">)</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h3 id="usage">Usage</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="c1"># Example</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="n">port</span> <span class="o">=</span> <span class="n">AccountPortfolio</span><span class="p">()</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="n">port</span><span class="o">.</span><span class="n">add_account</span><span class="p">(</span><span class="n">Account</span><span class="p">(</span><span class="s1">&#39;Guido&#39;</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">))</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="n">port</span><span class="o">.</span><span class="n">add_account</span><span class="p">(</span><span class="n">Account</span><span class="p">(</span><span class="s1">&#39;Eva&#39;</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">))</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="nb">print</span><span class="p">(</span><span class="n">port</span><span class="o">.</span><span class="n">total_funds</span><span class="p">())</span>    <span class="c1"># -&gt; 1050.0</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="nb">len</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>                    <span class="c1"># -&gt; 2</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="c1"># Print the accounts</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="k">for</span> <span class="n">account</span> <span class="ow">in</span> <span class="n">port</span><span class="p">:</span>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">account</span><span class="p">)</span>
<a id="__codelineno-1-12" name="__codelineno-1-12"></a>
<a id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="c1"># Access an individual account by index</span>
<a id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="n">port</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">inquiry</span><span class="p">()</span>            <span class="c1"># -&gt; 50.0</span>
</code></pre></div></td></tr></table></div>
<h2 id="avoiding-inheritance-via-composition">Avoiding Inheritance via Composition</h2>
<h3 id="inheritance">Inheritance</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-2-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-2-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-2-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-2-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-2-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-2-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-2-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-2-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-2-10">10</a></span>
<span class="normal"><a href="#__codelineno-2-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="k">class</span> <span class="nc">Stack</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a>    <span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="c1"># Example</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="n">s</span> <span class="o">=</span> <span class="n">Stack</span><span class="p">()</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="n">s</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="n">s</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="n">s</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="n">s</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>     <span class="c1"># -&gt; 3</span>
<a id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="n">s</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>     <span class="c1"># -&gt; 2</span>
</code></pre></div></td></tr></table></div>
<h3 id="composition">Composition</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span>
<span class="normal"><a href="#__codelineno-3-12">12</a></span>
<span class="normal"><a href="#__codelineno-3-13">13</a></span>
<span class="normal"><a href="#__codelineno-3-14">14</a></span>
<span class="normal"><a href="#__codelineno-3-15">15</a></span>
<span class="normal"><a href="#__codelineno-3-16">16</a></span>
<span class="normal"><a href="#__codelineno-3-17">17</a></span>
<span class="normal"><a href="#__codelineno-3-18">18</a></span>
<span class="normal"><a href="#__codelineno-3-19">19</a></span>
<span class="normal"><a href="#__codelineno-3-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="k">class</span> <span class="nc">Stack</span><span class="p">:</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a>    <span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a>    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<a id="__codelineno-3-10" name="__codelineno-3-10"></a>
<a id="__codelineno-3-11" name="__codelineno-3-11"></a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-3-12" name="__codelineno-3-12"></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="p">)</span>
<a id="__codelineno-3-13" name="__codelineno-3-13"></a>
<a id="__codelineno-3-14" name="__codelineno-3-14"></a><span class="c1"># Example use</span>
<a id="__codelineno-3-15" name="__codelineno-3-15"></a><span class="n">s</span> <span class="o">=</span> <span class="n">Stack</span><span class="p">()</span>
<a id="__codelineno-3-16" name="__codelineno-3-16"></a><span class="n">s</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-3-17" name="__codelineno-3-17"></a><span class="n">s</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-3-18" name="__codelineno-3-18"></a><span class="n">s</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-3-19" name="__codelineno-3-19"></a><span class="n">s</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>    <span class="c1"># -&gt; 3</span>
<a id="__codelineno-3-20" name="__codelineno-3-20"></a><span class="n">s</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>     <span class="c1"># -&gt; 2</span>
</code></pre></div></td></tr></table></div>
<h3 id="passing-container-as-argument">Passing Container as Argument</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span>
<span class="normal"><a href="#__codelineno-4-12">12</a></span>
<span class="normal"><a href="#__codelineno-4-13">13</a></span>
<span class="normal"><a href="#__codelineno-4-14">14</a></span>
<span class="normal"><a href="#__codelineno-4-15">15</a></span>
<span class="normal"><a href="#__codelineno-4-16">16</a></span>
<span class="normal"><a href="#__codelineno-4-17">17</a></span>
<span class="normal"><a href="#__codelineno-4-18">18</a></span>
<span class="normal"><a href="#__codelineno-4-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="k">class</span> <span class="nc">Stack</span><span class="p">:</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a>        <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a>            <span class="n">container</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_items</span> <span class="o">=</span> <span class="n">container</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a>    <span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a>
<a id="__codelineno-4-10" name="__codelineno-4-10"></a>    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-4-11" name="__codelineno-4-11"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<a id="__codelineno-4-12" name="__codelineno-4-12"></a>
<a id="__codelineno-4-13" name="__codelineno-4-13"></a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-4-14" name="__codelineno-4-14"></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="p">)</span>
<a id="__codelineno-4-15" name="__codelineno-4-15"></a>
<a id="__codelineno-4-16" name="__codelineno-4-16"></a><span class="n">s</span> <span class="o">=</span> <span class="n">Stack</span><span class="p">(</span><span class="n">container</span><span class="o">=</span><span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">))</span>
<a id="__codelineno-4-17" name="__codelineno-4-17"></a><span class="n">s</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<a id="__codelineno-4-18" name="__codelineno-4-18"></a><span class="n">s</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="mi">23</span><span class="p">)</span>
<a id="__codelineno-4-19" name="__codelineno-4-19"></a><span class="n">s</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s1">&#39;a lot&#39;</span><span class="p">)</span>     <span class="c1"># TypeError</span>
</code></pre></div></td></tr></table></div>
<p>This is also an example of what’s known as <em>dependency injection</em>. Instead of hardwiring Stack to depend on list, you can make it depend on any container a user decides to pass in, provided it implements the required interface.</p>
<h2 id="avoid-inheritance-via-functions">Avoid Inheritance via Functions</h2>
<p>If there is too much plumbing going on here. If you’re writing a lot of single-method classes, consider using functions instead. </p>
<h3 id="class-based-parsing">Class Based Parsing</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span>
<span class="normal"><a href="#__codelineno-5-12">12</a></span>
<span class="normal"><a href="#__codelineno-5-13">13</a></span>
<span class="normal"><a href="#__codelineno-5-14">14</a></span>
<span class="normal"><a href="#__codelineno-5-15">15</a></span>
<span class="normal"><a href="#__codelineno-5-16">16</a></span>
<span class="normal"><a href="#__codelineno-5-17">17</a></span>
<span class="normal"><a href="#__codelineno-5-18">18</a></span>
<span class="normal"><a href="#__codelineno-5-19">19</a></span>
<span class="normal"><a href="#__codelineno-5-20">20</a></span>
<span class="normal"><a href="#__codelineno-5-21">21</a></span>
<span class="normal"><a href="#__codelineno-5-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="k">class</span> <span class="nc">DataParser</span><span class="p">:</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a>        <span class="n">records</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a>        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a>            <span class="n">row</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a>            <span class="n">record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_record</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a>            <span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a>        <span class="k">return</span> <span class="n">records</span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a>    <span class="k">def</span> <span class="nf">make_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
<a id="__codelineno-5-12" name="__codelineno-5-12"></a>
<a id="__codelineno-5-13" name="__codelineno-5-13"></a><span class="k">class</span> <span class="nc">PortfolioDataParser</span><span class="p">(</span><span class="n">DataParser</span><span class="p">):</span>
<a id="__codelineno-5-14" name="__codelineno-5-14"></a>    <span class="k">def</span> <span class="nf">make_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
<a id="__codelineno-5-15" name="__codelineno-5-15"></a>        <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-5-16" name="__codelineno-5-16"></a>           <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-5-17" name="__codelineno-5-17"></a>           <span class="s1">&#39;shares&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
<a id="__codelineno-5-18" name="__codelineno-5-18"></a>           <span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<a id="__codelineno-5-19" name="__codelineno-5-19"></a>        <span class="p">}</span>
<a id="__codelineno-5-20" name="__codelineno-5-20"></a>
<a id="__codelineno-5-21" name="__codelineno-5-21"></a><span class="n">parser</span> <span class="o">=</span> <span class="n">PortfolioDataParser</span><span class="p">()</span>
<a id="__codelineno-5-22" name="__codelineno-5-22"></a><span class="n">data</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;portfolio.csv&#39;</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
<h3 id="function-based-parsing">Function Based Parsing</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span>
<span class="normal"><a href="#__codelineno-6-13">13</a></span>
<span class="normal"><a href="#__codelineno-6-14">14</a></span>
<span class="normal"><a href="#__codelineno-6-15">15</a></span>
<span class="normal"><a href="#__codelineno-6-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="k">def</span> <span class="nf">parse_data</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">make_record</span><span class="p">):</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a>    <span class="n">records</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a>    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a>        <span class="n">row</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a>        <span class="n">record</span> <span class="o">=</span> <span class="n">make_record</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a>        <span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a>    <span class="k">return</span> <span class="n">records</span>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="k">def</span> <span class="nf">make_dict</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
<a id="__codelineno-6-10" name="__codelineno-6-10"></a>    <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-6-11" name="__codelineno-6-11"></a>        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-6-12" name="__codelineno-6-12"></a>        <span class="s1">&#39;shares&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
<a id="__codelineno-6-13" name="__codelineno-6-13"></a>        <span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<a id="__codelineno-6-14" name="__codelineno-6-14"></a>    <span class="p">}</span>
<a id="__codelineno-6-15" name="__codelineno-6-15"></a>
<a id="__codelineno-6-16" name="__codelineno-6-16"></a><span class="n">data</span> <span class="o">=</span> <span class="n">parse_data</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;portfolio.csv&#39;</span><span class="p">),</span> <span class="n">make_dict</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h1 id="dynamic-binding-and-duck-typing">Dynamic Binding and Duck Typing</h1>
<p>Dynamic binding is the runtime mechanism that Python uses to find the attributes of objects. This is what allows Python to work with instances without regard for their type. In Python, variable names do not have an associated type. Thus, the attribute binding process is independent of what kind of object <code>obj</code> is. If you make a lookup, such as <code>obj.name</code>, it will work on any <code>obj</code> whatsoever that happens to have a <code>name</code> attribute. This behavior is sometimes referred to as <strong>duck typing</strong>—in reference to the adage “if it looks like a duck, quacks like a duck, and walks like a duck, then it’s a duck.”</p>
<p>Python programmers often write programs that rely on this behavior. For example, if you want to make a customized version of an existing object, you can either inherit from it, or you can create a completely new object that looks and acts like it but is otherwise unrelated. This latter approach is often used to maintain loose coupling of program components. For example, code may be written to work with any kind of object whatsoever as long as it has a certain set of methods. One of the most common examples is with various iterable objects defined in the standard library. There are all sorts of objects that work with the <code>for</code> loop to produce values—lists, files, generators, strings, and so on. However, none of these inherit from any kind of special <code>Iterable</code> base class. They merely implement the methods required to perform iteration—and it all works.</p>
<h2 id="dont-inherit-builtin-types">Don't Inherit Builtin Types</h2>
<p><code>dict</code>, <code>list</code> they are written in C and bypass <code>__setitem__</code> and <code>__getitem__</code>.</p>
<p>If you want to use <code>UserDict</code>, import it like this: <code>from collections import UserDict</code>.</p>
<h2 id="class-variables-vs-methods">Class Variables vs Methods</h2>
<p>In a class definition, all functions are assumed to operate on an instance, which is always passed as the first parameter <code>self</code>. However, the class itself is also an object that can carry state and be manipulated as well. As an example, you could track how many instances have been created using a class variable <code>num_accounts</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span>
<span class="normal"><a href="#__codelineno-7-12">12</a></span>
<span class="normal"><a href="#__codelineno-7-13">13</a></span>
<span class="normal"><a href="#__codelineno-7-14">14</a></span>
<span class="normal"><a href="#__codelineno-7-15">15</a></span>
<span class="normal"><a href="#__codelineno-7-16">16</a></span>
<span class="normal"><a href="#__codelineno-7-17">17</a></span>
<span class="normal"><a href="#__codelineno-7-18">18</a></span>
<span class="normal"><a href="#__codelineno-7-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="k">class</span> <span class="nc">Account</span><span class="p">:</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a>    <span class="n">num_accounts</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">balance</span><span class="p">):</span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">owner</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">=</span> <span class="n">balance</span>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a>        <span class="n">Account</span><span class="o">.</span><span class="n">num_accounts</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-7-8" name="__codelineno-7-8"></a>
<a id="__codelineno-7-9" name="__codelineno-7-9"></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-7-10" name="__codelineno-7-10"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">owner</span><span class="si">!r}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="si">!r}</span><span class="s1">)&#39;</span>
<a id="__codelineno-7-11" name="__codelineno-7-11"></a>
<a id="__codelineno-7-12" name="__codelineno-7-12"></a>    <span class="k">def</span> <span class="nf">deposit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
<a id="__codelineno-7-13" name="__codelineno-7-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">+=</span> <span class="n">amount</span>
<a id="__codelineno-7-14" name="__codelineno-7-14"></a>
<a id="__codelineno-7-15" name="__codelineno-7-15"></a>    <span class="k">def</span> <span class="nf">withdraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
<a id="__codelineno-7-16" name="__codelineno-7-16"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deposit</span><span class="p">(</span><span class="o">-</span><span class="n">amount</span><span class="p">)</span>    <span class="c1"># Must use self.deposit()</span>
<a id="__codelineno-7-17" name="__codelineno-7-17"></a>
<a id="__codelineno-7-18" name="__codelineno-7-18"></a>    <span class="k">def</span> <span class="nf">inquiry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-7-19" name="__codelineno-7-19"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span>
</code></pre></div></td></tr></table></div>
<p>Class variables are defined outside the normal <code>__init__()</code> method. To modify them, use the class, not <code>self</code>. For example:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span>
<span class="normal"><a href="#__codelineno-8-2">2</a></span>
<span class="normal"><a href="#__codelineno-8-3">3</a></span>
<span class="normal"><a href="#__codelineno-8-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="s1">&#39;Guido&#39;</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">)</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="s1">&#39;Eva&#39;</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">Account</span><span class="o">.</span><span class="n">num_accounts</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="mi">2</span>
</code></pre></div></td></tr></table></div>
<h2 id="classmethod-usage-alternative-way-of-creating-a-class"><code>classmethod</code> Usage: Alternative Way of Creating a Class</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-9-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-9-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-9-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-9-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-9-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-9-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-9-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-9-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-9-10">10</a></span>
<span class="normal"><a href="#__codelineno-9-11">11</a></span>
<span class="normal"><a href="#__codelineno-9-12">12</a></span>
<span class="normal"><a href="#__codelineno-9-13">13</a></span>
<span class="normal"><a href="#__codelineno-9-14">14</a></span>
<span class="normal"><a href="#__codelineno-9-15">15</a></span>
<span class="normal"><a href="#__codelineno-9-16">16</a></span>
<span class="normal"><a href="#__codelineno-9-17">17</a></span>
<span class="normal"><a href="#__codelineno-9-18">18</a></span>
<span class="normal"><a href="#__codelineno-9-19">19</a></span>
<span class="normal"><a href="#__codelineno-9-20">20</a></span>
<span class="normal"><a href="#__codelineno-9-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="k">class</span> <span class="nc">Account</span><span class="p">:</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">balance</span><span class="p">):</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">owner</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">=</span> <span class="n">balance</span>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a>
<a id="__codelineno-9-6" name="__codelineno-9-6"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-9-7" name="__codelineno-9-7"></a>    <span class="k">def</span> <span class="nf">from_xml</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<a id="__codelineno-9-8" name="__codelineno-9-8"></a>        <span class="kn">from</span> <span class="nn">xml.etree.ElementTree</span> <span class="kn">import</span> <span class="n">XML</span>
<a id="__codelineno-9-9" name="__codelineno-9-9"></a>        <span class="n">doc</span> <span class="o">=</span> <span class="n">XML</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-9-10" name="__codelineno-9-10"></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">findtext</span><span class="p">(</span><span class="s1">&#39;owner&#39;</span><span class="p">),</span>
<a id="__codelineno-9-11" name="__codelineno-9-11"></a>                   <span class="nb">float</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">findtext</span><span class="p">(</span><span class="s1">&#39;amount&#39;</span><span class="p">)))</span>
<a id="__codelineno-9-12" name="__codelineno-9-12"></a>
<a id="__codelineno-9-13" name="__codelineno-9-13"></a><span class="c1"># Example use</span>
<a id="__codelineno-9-14" name="__codelineno-9-14"></a>
<a id="__codelineno-9-15" name="__codelineno-9-15"></a><span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<a id="__codelineno-9-16" name="__codelineno-9-16"></a><span class="s1">&lt;account&gt;</span>
<a id="__codelineno-9-17" name="__codelineno-9-17"></a><span class="s1">    &lt;owner&gt;Guido&lt;/owner&gt;</span>
<a id="__codelineno-9-18" name="__codelineno-9-18"></a><span class="s1">    &lt;amount&gt;1000.0&lt;/amount&gt;</span>
<a id="__codelineno-9-19" name="__codelineno-9-19"></a><span class="s1">&lt;/account&gt;</span>
<a id="__codelineno-9-20" name="__codelineno-9-20"></a><span class="s1">&#39;&#39;&#39;</span>
<a id="__codelineno-9-21" name="__codelineno-9-21"></a><span class="n">a</span> <span class="o">=</span> <span class="n">Account</span><span class="o">.</span><span class="n">from_xml</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h2 id="configuration-of-classes">Configuration of Classes</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-10-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-10-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-10-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-10-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-10-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-10-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-10-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-10-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-10-10">10</a></span>
<span class="normal"><a href="#__codelineno-10-11">11</a></span>
<span class="normal"><a href="#__codelineno-10-12">12</a></span>
<span class="normal"><a href="#__codelineno-10-13">13</a></span>
<span class="normal"><a href="#__codelineno-10-14">14</a></span>
<span class="normal"><a href="#__codelineno-10-15">15</a></span>
<span class="normal"><a href="#__codelineno-10-16">16</a></span>
<span class="normal"><a href="#__codelineno-10-17">17</a></span>
<span class="normal"><a href="#__codelineno-10-18">18</a></span>
<span class="normal"><a href="#__codelineno-10-19">19</a></span>
<span class="normal"><a href="#__codelineno-10-20">20</a></span>
<span class="normal"><a href="#__codelineno-10-21">21</a></span>
<span class="normal"><a href="#__codelineno-10-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="kn">import</span> <span class="nn">time</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="k">class</span> <span class="nc">Date</span><span class="p">:</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a>    <span class="n">datefmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{year}</span><span class="s1">-</span><span class="si">{month:02d}</span><span class="s1">-</span><span class="si">{day:02d}</span><span class="s1">&#39;</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">):</span>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">year</span> <span class="o">=</span> <span class="n">year</span>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">month</span> <span class="o">=</span> <span class="n">month</span>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">day</span> <span class="o">=</span> <span class="n">day</span>
<a id="__codelineno-10-9" name="__codelineno-10-9"></a>
<a id="__codelineno-10-10" name="__codelineno-10-10"></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-10-11" name="__codelineno-10-11"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datefmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
<a id="__codelineno-10-12" name="__codelineno-10-12"></a>                                   <span class="n">month</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
<a id="__codelineno-10-13" name="__codelineno-10-13"></a>                                   <span class="n">day</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
<a id="__codelineno-10-14" name="__codelineno-10-14"></a>
<a id="__codelineno-10-15" name="__codelineno-10-15"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-10-16" name="__codelineno-10-16"></a>    <span class="k">def</span> <span class="nf">from_timestamp</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">ts</span><span class="p">):</span>
<a id="__codelineno-10-17" name="__codelineno-10-17"></a>        <span class="n">tm</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
<a id="__codelineno-10-18" name="__codelineno-10-18"></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">tm</span><span class="o">.</span><span class="n">tm_year</span><span class="p">,</span> <span class="n">tm</span><span class="o">.</span><span class="n">tm_mon</span><span class="p">,</span> <span class="n">tm</span><span class="o">.</span><span class="n">tm_mday</span><span class="p">)</span>
<a id="__codelineno-10-19" name="__codelineno-10-19"></a>
<a id="__codelineno-10-20" name="__codelineno-10-20"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-10-21" name="__codelineno-10-21"></a>    <span class="k">def</span> <span class="nf">today</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<a id="__codelineno-10-22" name="__codelineno-10-22"></a>        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_timestamp</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
<p>This class features a class variable <code>datefmt</code> that adjusts output from the <code>__str__()</code> method. This is something that can be customized via inheritance:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-11-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-11-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-11-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-11-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-11-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-11-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-11-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-11-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-11-10">10</a></span>
<span class="normal"><a href="#__codelineno-11-11">11</a></span>
<span class="normal"><a href="#__codelineno-11-12">12</a></span>
<span class="normal"><a href="#__codelineno-11-13">13</a></span>
<span class="normal"><a href="#__codelineno-11-14">14</a></span>
<span class="normal"><a href="#__codelineno-11-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="k">class</span> <span class="nc">MDYDate</span><span class="p">(</span><span class="n">Date</span><span class="p">):</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a>    <span class="n">datefmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{month}</span><span class="s1">/</span><span class="si">{day}</span><span class="s1">/</span><span class="si">{year}</span><span class="s1">&#39;</span>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="k">class</span> <span class="nc">DMYDate</span><span class="p">(</span><span class="n">Date</span><span class="p">):</span>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a>    <span class="n">datefmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{day}</span><span class="s1">/</span><span class="si">{month}</span><span class="s1">/</span><span class="si">{year}</span><span class="s1">&#39;</span>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a>
<a id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="c1"># Example</span>
<a id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="n">a</span> <span class="o">=</span> <span class="n">Date</span><span class="p">(</span><span class="mi">1967</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<a id="__codelineno-11-9" name="__codelineno-11-9"></a><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>       <span class="c1"># 1967-04-09</span>
<a id="__codelineno-11-10" name="__codelineno-11-10"></a>
<a id="__codelineno-11-11" name="__codelineno-11-11"></a><span class="n">b</span> <span class="o">=</span> <span class="n">MDYDate</span><span class="p">(</span><span class="mi">1967</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<a id="__codelineno-11-12" name="__codelineno-11-12"></a><span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>       <span class="c1"># 4/9/1967</span>
<a id="__codelineno-11-13" name="__codelineno-11-13"></a>
<a id="__codelineno-11-14" name="__codelineno-11-14"></a><span class="n">c</span> <span class="o">=</span> <span class="n">DMYDate</span><span class="p">(</span><span class="mi">1967</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<a id="__codelineno-11-15" name="__codelineno-11-15"></a><span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>      <span class="c1"># 9/4/1967</span>
</code></pre></div></td></tr></table></div>
<h2 id="dictfrom_keys-example"><code>dict.from_keys()</code> Example</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span>
<span class="normal"><a href="#__codelineno-12-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="nb">dict</span><span class="o">.</span><span class="n">from_keys</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="c1"># Output: {&#39;a&#39;: 0, &#39;b&#39;: 0, &#39;c&#39;: 0}</span>
</code></pre></div></td></tr></table></div>
<h2 id="static-methods">Static Methods</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-13-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-13-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-13-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-13-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-13-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-13-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-13-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-13-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-13-10">10</a></span>
<span class="normal"><a href="#__codelineno-13-11">11</a></span>
<span class="normal"><a href="#__codelineno-13-12">12</a></span>
<span class="normal"><a href="#__codelineno-13-13">13</a></span>
<span class="normal"><a href="#__codelineno-13-14">14</a></span>
<span class="normal"><a href="#__codelineno-13-15">15</a></span>
<span class="normal"><a href="#__codelineno-13-16">16</a></span>
<span class="normal"><a href="#__codelineno-13-17">17</a></span>
<span class="normal"><a href="#__codelineno-13-18">18</a></span>
<span class="normal"><a href="#__codelineno-13-19">19</a></span>
<span class="normal"><a href="#__codelineno-13-20">20</a></span>
<span class="normal"><a href="#__codelineno-13-21">21</a></span>
<span class="normal"><a href="#__codelineno-13-22">22</a></span>
<span class="normal"><a href="#__codelineno-13-23">23</a></span>
<span class="normal"><a href="#__codelineno-13-24">24</a></span>
<span class="normal"><a href="#__codelineno-13-25">25</a></span>
<span class="normal"><a href="#__codelineno-13-26">26</a></span>
<span class="normal"><a href="#__codelineno-13-27">27</a></span>
<span class="normal"><a href="#__codelineno-13-28">28</a></span>
<span class="normal"><a href="#__codelineno-13-29">29</a></span>
<span class="normal"><a href="#__codelineno-13-30">30</a></span>
<span class="normal"><a href="#__codelineno-13-31">31</a></span>
<span class="normal"><a href="#__codelineno-13-32">32</a></span>
<span class="normal"><a href="#__codelineno-13-33">33</a></span>
<span class="normal"><a href="#__codelineno-13-34">34</a></span>
<span class="normal"><a href="#__codelineno-13-35">35</a></span>
<span class="normal"><a href="#__codelineno-13-36">36</a></span>
<span class="normal"><a href="#__codelineno-13-37">37</a></span>
<span class="normal"><a href="#__codelineno-13-38">38</a></span>
<span class="normal"><a href="#__codelineno-13-39">39</a></span>
<span class="normal"><a href="#__codelineno-13-40">40</a></span>
<span class="normal"><a href="#__codelineno-13-41">41</a></span>
<span class="normal"><a href="#__codelineno-13-42">42</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="k">class</span> <span class="nc">StandardPolicy</span><span class="p">:</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a>    <span class="k">def</span> <span class="nf">deposit</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a>        <span class="n">account</span><span class="o">.</span><span class="n">balance</span> <span class="o">+=</span> <span class="n">amount</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a>    <span class="k">def</span> <span class="nf">withdraw</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a>        <span class="n">account</span><span class="o">.</span><span class="n">balance</span> <span class="o">-=</span> <span class="n">amount</span>
<a id="__codelineno-13-9" name="__codelineno-13-9"></a>
<a id="__codelineno-13-10" name="__codelineno-13-10"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-13-11" name="__codelineno-13-11"></a>    <span class="k">def</span> <span class="nf">inquiry</span><span class="p">(</span><span class="n">account</span><span class="p">):</span>
<a id="__codelineno-13-12" name="__codelineno-13-12"></a>        <span class="k">return</span> <span class="n">account</span><span class="o">.</span><span class="n">balance</span>
<a id="__codelineno-13-13" name="__codelineno-13-13"></a>
<a id="__codelineno-13-14" name="__codelineno-13-14"></a><span class="k">class</span> <span class="nc">EvilPolicy</span><span class="p">(</span><span class="n">StandardPolicy</span><span class="p">):</span>
<a id="__codelineno-13-15" name="__codelineno-13-15"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-13-16" name="__codelineno-13-16"></a>    <span class="k">def</span> <span class="nf">deposit</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
<a id="__codelineno-13-17" name="__codelineno-13-17"></a>        <span class="n">account</span><span class="o">.</span><span class="n">balance</span> <span class="o">+=</span> <span class="mf">0.95</span><span class="o">*</span><span class="n">amount</span>
<a id="__codelineno-13-18" name="__codelineno-13-18"></a>
<a id="__codelineno-13-19" name="__codelineno-13-19"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-13-20" name="__codelineno-13-20"></a>    <span class="k">def</span> <span class="nf">inquiry</span><span class="p">(</span><span class="n">account</span><span class="p">):</span>
<a id="__codelineno-13-21" name="__codelineno-13-21"></a>        <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-13-22" name="__codelineno-13-22"></a>           <span class="k">return</span> <span class="mf">1.10</span> <span class="o">*</span> <span class="n">account</span><span class="o">.</span><span class="n">balance</span>
<a id="__codelineno-13-23" name="__codelineno-13-23"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-13-24" name="__codelineno-13-24"></a>           <span class="k">return</span> <span class="n">account</span><span class="o">.</span><span class="n">balance</span>
<a id="__codelineno-13-25" name="__codelineno-13-25"></a>
<a id="__codelineno-13-26" name="__codelineno-13-26"></a><span class="k">class</span> <span class="nc">Account</span><span class="p">:</span>
<a id="__codelineno-13-27" name="__codelineno-13-27"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">balance</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">policy</span><span class="o">=</span><span class="n">StandardPolicy</span><span class="p">):</span>
<a id="__codelineno-13-28" name="__codelineno-13-28"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">owner</span>
<a id="__codelineno-13-29" name="__codelineno-13-29"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">=</span> <span class="n">balance</span>
<a id="__codelineno-13-30" name="__codelineno-13-30"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">policy</span> <span class="o">=</span> <span class="n">policy</span>
<a id="__codelineno-13-31" name="__codelineno-13-31"></a>
<a id="__codelineno-13-32" name="__codelineno-13-32"></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-13-33" name="__codelineno-13-33"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;Account(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">policy</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">owner</span><span class="si">!r}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="si">!r}</span><span class="s1">)&#39;</span>
<a id="__codelineno-13-34" name="__codelineno-13-34"></a>
<a id="__codelineno-13-35" name="__codelineno-13-35"></a>    <span class="k">def</span> <span class="nf">deposit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
<a id="__codelineno-13-36" name="__codelineno-13-36"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">policy</span><span class="o">.</span><span class="n">deposit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>
<a id="__codelineno-13-37" name="__codelineno-13-37"></a>
<a id="__codelineno-13-38" name="__codelineno-13-38"></a>    <span class="k">def</span> <span class="nf">withdraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
<a id="__codelineno-13-39" name="__codelineno-13-39"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">policy</span><span class="o">.</span><span class="n">withdraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>
<a id="__codelineno-13-40" name="__codelineno-13-40"></a>
<a id="__codelineno-13-41" name="__codelineno-13-41"></a>    <span class="k">def</span> <span class="nf">inquiry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-13-42" name="__codelineno-13-42"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">policy</span><span class="o">.</span><span class="n">inquiry</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h1 id="about-design-patterns">About Design Patterns</h1>
<p>In writing object-oriented programs, programmers sometimes get fixated on implementing named design patterns—such as the <em>strategy pattern</em>, the <em>flyweight pattern</em>, the <em>singleton pattern</em>, and so forth. Many of these originate from the famous <em>Design Patterns</em> book by Erich Gamma, Richard Helm, Ralph Johnson, and John Vlissides.</p>
<p>If you are familiar with such patterns, the general design principles used in other languages can certainly be applied to Python. However, many of these documented patterns are aimed at working around specific issues that arise from the strict static type system of C++ or Java. The dynamic nature of Python renders a lot of these patterns obsolete, an overkill, or simply unnecessary.</p>
<p>That said, there are a few overarching principles of writing good software—such as striving to write code that is debuggable, testable, and extensible. Basic strategies such as writing classes with useful <code>__repr__()</code> methods, preferring composition over inheritance, and allowing dependency injection can go a long way towards these goals. Python programmers also like to work with code that can be said to be <em>Pythonic</em>. Usually, that means that objects obey various built-in protocols, such as iteration, containers, or context management. For example, instead of trying to implement some exotic data traversal pattern from a Java programming book, a Python programmer would probably implement it with a generator function feeding a <code>for</code> loop, or just replace the entire pattern with a few dictionary lookups.</p>
<h2 id="properties">Properties</h2>
<p>As noted in the previous section, Python places no runtime restrictions on attribute values or types. However, such enforcement is possible if you put an attribute under the management of a so-called <em>property</em>. A property is a special kind of attribute that intercepts attribute access and handles it via user-defined methods. These methods have complete freedom to manage the attribute as they see fit. Here is an example:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-14-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-14-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-14-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-14-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-14-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-14-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-14-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-14-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-14-10">10</a></span>
<span class="normal"><a href="#__codelineno-14-11">11</a></span>
<span class="normal"><a href="#__codelineno-14-12">12</a></span>
<span class="normal"><a href="#__codelineno-14-13">13</a></span>
<span class="normal"><a href="#__codelineno-14-14">14</a></span>
<span class="normal"><a href="#__codelineno-14-15">15</a></span>
<span class="normal"><a href="#__codelineno-14-16">16</a></span>
<span class="normal"><a href="#__codelineno-14-17">17</a></span>
<span class="normal"><a href="#__codelineno-14-18">18</a></span>
<span class="normal"><a href="#__codelineno-14-19">19</a></span>
<span class="normal"><a href="#__codelineno-14-20">20</a></span>
<span class="normal"><a href="#__codelineno-14-21">21</a></span>
<span class="normal"><a href="#__codelineno-14-22">22</a></span>
<span class="normal"><a href="#__codelineno-14-23">23</a></span>
<span class="normal"><a href="#__codelineno-14-24">24</a></span>
<span class="normal"><a href="#__codelineno-14-25">25</a></span>
<span class="normal"><a href="#__codelineno-14-26">26</a></span>
<span class="normal"><a href="#__codelineno-14-27">27</a></span>
<span class="normal"><a href="#__codelineno-14-28">28</a></span>
<span class="normal"><a href="#__codelineno-14-29">29</a></span>
<span class="normal"><a href="#__codelineno-14-30">30</a></span>
<span class="normal"><a href="#__codelineno-14-31">31</a></span>
<span class="normal"><a href="#__codelineno-14-32">32</a></span>
<span class="normal"><a href="#__codelineno-14-33">33</a></span>
<span class="normal"><a href="#__codelineno-14-34">34</a></span>
<span class="normal"><a href="#__codelineno-14-35">35</a></span>
<span class="normal"><a href="#__codelineno-14-36">36</a></span>
<span class="normal"><a href="#__codelineno-14-37">37</a></span>
<span class="normal"><a href="#__codelineno-14-38">38</a></span>
<span class="normal"><a href="#__codelineno-14-39">39</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="kn">import</span> <span class="nn">string</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="k">class</span> <span class="nc">Account</span><span class="p">:</span>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">balance</span><span class="p">):</span>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">owner</span>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_balance</span> <span class="o">=</span> <span class="n">balance</span>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a>
<a id="__codelineno-14-8" name="__codelineno-14-8"></a>    <span class="nd">@property</span>
<a id="__codelineno-14-9" name="__codelineno-14-9"></a>    <span class="k">def</span> <span class="nf">owner</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-14-10" name="__codelineno-14-10"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span>
<a id="__codelineno-14-11" name="__codelineno-14-11"></a>
<a id="__codelineno-14-12" name="__codelineno-14-12"></a>    <span class="nd">@owner</span><span class="o">.</span><span class="n">setter</span>
<a id="__codelineno-14-13" name="__codelineno-14-13"></a>    <span class="k">def</span> <span class="nf">owner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<a id="__codelineno-14-14" name="__codelineno-14-14"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-14-15" name="__codelineno-14-15"></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Expected str&#39;</span><span class="p">)</span>
<a id="__codelineno-14-16" name="__codelineno-14-16"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">c</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_uppercase</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">value</span><span class="p">):</span>
<a id="__codelineno-14-17" name="__codelineno-14-17"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Must be uppercase ASCII&#39;</span><span class="p">)</span>
<a id="__codelineno-14-18" name="__codelineno-14-18"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
<a id="__codelineno-14-19" name="__codelineno-14-19"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Must be 10 characters or less&#39;</span><span class="p">)</span>
<a id="__codelineno-14-20" name="__codelineno-14-20"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span> <span class="o">=</span> <span class="n">value</span>
<a id="__codelineno-14-21" name="__codelineno-14-21"></a>
<a id="__codelineno-14-22" name="__codelineno-14-22"></a><span class="k">class</span> <span class="nc">SomeClass</span><span class="p">:</span>
<a id="__codelineno-14-23" name="__codelineno-14-23"></a>    <span class="nd">@property</span>
<a id="__codelineno-14-24" name="__codelineno-14-24"></a>    <span class="k">def</span> <span class="nf">attr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-14-25" name="__codelineno-14-25"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Getting&#39;</span><span class="p">)</span>
<a id="__codelineno-14-26" name="__codelineno-14-26"></a>
<a id="__codelineno-14-27" name="__codelineno-14-27"></a>    <span class="nd">@attr</span><span class="o">.</span><span class="n">setter</span>
<a id="__codelineno-14-28" name="__codelineno-14-28"></a>    <span class="k">def</span> <span class="nf">attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<a id="__codelineno-14-29" name="__codelineno-14-29"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Setting&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<a id="__codelineno-14-30" name="__codelineno-14-30"></a>
<a id="__codelineno-14-31" name="__codelineno-14-31"></a>    <span class="nd">@attr</span><span class="o">.</span><span class="n">deleter</span>
<a id="__codelineno-14-32" name="__codelineno-14-32"></a>    <span class="k">def</span> <span class="nf">attr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-14-33" name="__codelineno-14-33"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Deleting&#39;</span><span class="p">)</span>
<a id="__codelineno-14-34" name="__codelineno-14-34"></a>
<a id="__codelineno-14-35" name="__codelineno-14-35"></a><span class="c1"># Example</span>
<a id="__codelineno-14-36" name="__codelineno-14-36"></a><span class="n">s</span> <span class="o">=</span> <span class="n">SomeClass</span><span class="p">()</span>
<a id="__codelineno-14-37" name="__codelineno-14-37"></a><span class="n">s</span><span class="o">.</span><span class="n">attr</span>         <span class="c1"># Getting</span>
<a id="__codelineno-14-38" name="__codelineno-14-38"></a><span class="n">s</span><span class="o">.</span><span class="n">attr</span> <span class="o">=</span> <span class="mi">13</span>    <span class="c1"># Setting</span>
<a id="__codelineno-14-39" name="__codelineno-14-39"></a><span class="k">del</span> <span class="n">s</span><span class="o">.</span><span class="n">attr</span>     <span class="c1"># Deleting</span>
</code></pre></div></td></tr></table></div>
<h2 id="types-interfaces-abstract-classes">Types, Interfaces, Abstract Classes</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-15-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-15-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-15-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-15-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-15-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-15-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-15-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-15-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-15-10">10</a></span>
<span class="normal"><a href="#__codelineno-15-11">11</a></span>
<span class="normal"><a href="#__codelineno-15-12">12</a></span>
<span class="normal"><a href="#__codelineno-15-13">13</a></span>
<span class="normal"><a href="#__codelineno-15-14">14</a></span>
<span class="normal"><a href="#__codelineno-15-15">15</a></span>
<span class="normal"><a href="#__codelineno-15-16">16</a></span>
<span class="normal"><a href="#__codelineno-15-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a>    <span class="k">pass</span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a>    <span class="k">pass</span>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="k">class</span> <span class="nc">C</span><span class="p">:</span>
<a id="__codelineno-15-8" name="__codelineno-15-8"></a>    <span class="k">pass</span>
<a id="__codelineno-15-9" name="__codelineno-15-9"></a>
<a id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>           <span class="c1"># Instance of &#39;A&#39;</span>
<a id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="n">b</span> <span class="o">=</span> <span class="n">B</span><span class="p">()</span>           <span class="c1"># Instance of &#39;B&#39;</span>
<a id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="n">c</span> <span class="o">=</span> <span class="n">C</span><span class="p">()</span>           <span class="c1"># Instance of &#39;C&#39;</span>
<a id="__codelineno-15-13" name="__codelineno-15-13"></a>
<a id="__codelineno-15-14" name="__codelineno-15-14"></a><span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>           <span class="c1"># Returns the class object A</span>
<a id="__codelineno-15-15" name="__codelineno-15-15"></a><span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>  <span class="c1"># Returns True</span>
<a id="__codelineno-15-16" name="__codelineno-15-16"></a><span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>  <span class="c1"># Returns True, B derives from A</span>
<a id="__codelineno-15-17" name="__codelineno-15-17"></a><span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>  <span class="c1"># Returns False, B not derived from C</span>
</code></pre></div></td></tr></table></div>
<p><strong>Note</strong>: ABC must be implemented.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-16-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-16-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-16-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-16-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-16-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-16-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-16-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-16-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-16-10">10</a></span>
<span class="normal"><a href="#__codelineno-16-11">11</a></span>
<span class="normal"><a href="#__codelineno-16-12">12</a></span>
<span class="normal"><a href="#__codelineno-16-13">13</a></span>
<span class="normal"><a href="#__codelineno-16-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="k">class</span> <span class="nc">Stream</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a>    <span class="k">def</span> <span class="nf">receive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a>        <span class="k">pass</span>
<a id="__codelineno-16-7" name="__codelineno-16-7"></a>
<a id="__codelineno-16-8" name="__codelineno-16-8"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-16-9" name="__codelineno-16-9"></a>    <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
<a id="__codelineno-16-10" name="__codelineno-16-10"></a>        <span class="k">pass</span>
<a id="__codelineno-16-11" name="__codelineno-16-11"></a>
<a id="__codelineno-16-12" name="__codelineno-16-12"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-16-13" name="__codelineno-16-13"></a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-16-14" name="__codelineno-16-14"></a>        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
<h1 id="multiple-inheritance-and-mixins">Multiple Inheritance and Mixins</h1>
<h2 id="interfaces-using-abc-classes">Interfaces using ABC Classes</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-17-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-17-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-17-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-17-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-17-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-17-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-17-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-17-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-17-10">10</a></span>
<span class="normal"><a href="#__codelineno-17-11">11</a></span>
<span class="normal"><a href="#__codelineno-17-12">12</a></span>
<span class="normal"><a href="#__codelineno-17-13">13</a></span>
<span class="normal"><a href="#__codelineno-17-14">14</a></span>
<span class="normal"><a href="#__codelineno-17-15">15</a></span>
<span class="normal"><a href="#__codelineno-17-16">16</a></span>
<span class="normal"><a href="#__codelineno-17-17">17</a></span>
<span class="normal"><a href="#__codelineno-17-18">18</a></span>
<span class="normal"><a href="#__codelineno-17-19">19</a></span>
<span class="normal"><a href="#__codelineno-17-20">20</a></span>
<span class="normal"><a href="#__codelineno-17-21">21</a></span>
<span class="normal"><a href="#__codelineno-17-22">22</a></span>
<span class="normal"><a href="#__codelineno-17-23">23</a></span>
<span class="normal"><a href="#__codelineno-17-24">24</a></span>
<span class="normal"><a href="#__codelineno-17-25">25</a></span>
<span class="normal"><a href="#__codelineno-17-26">26</a></span>
<span class="normal"><a href="#__codelineno-17-27">27</a></span>
<span class="normal"><a href="#__codelineno-17-28">28</a></span>
<span class="normal"><a href="#__codelineno-17-29">29</a></span>
<span class="normal"><a href="#__codelineno-17-30">30</a></span>
<span class="normal"><a href="#__codelineno-17-31">31</a></span>
<span class="normal"><a href="#__codelineno-17-32">32</a></span>
<span class="normal"><a href="#__codelineno-17-33">33</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="k">class</span> <span class="nc">Stream</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a>    <span class="k">def</span> <span class="nf">receive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-17-6" name="__codelineno-17-6"></a>        <span class="k">pass</span>
<a id="__codelineno-17-7" name="__codelineno-17-7"></a>
<a id="__codelineno-17-8" name="__codelineno-17-8"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-17-9" name="__codelineno-17-9"></a>    <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
<a id="__codelineno-17-10" name="__codelineno-17-10"></a>        <span class="k">pass</span>
<a id="__codelineno-17-11" name="__codelineno-17-11"></a>
<a id="__codelineno-17-12" name="__codelineno-17-12"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-17-13" name="__codelineno-17-13"></a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-17-14" name="__codelineno-17-14"></a>        <span class="k">pass</span>
<a id="__codelineno-17-15" name="__codelineno-17-15"></a>
<a id="__codelineno-17-16" name="__codelineno-17-16"></a><span class="k">class</span> <span class="nc">Iterable</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<a id="__codelineno-17-17" name="__codelineno-17-17"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-17-18" name="__codelineno-17-18"></a>    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-17-19" name="__codelineno-17-19"></a>        <span class="k">pass</span>
<a id="__codelineno-17-20" name="__codelineno-17-20"></a>
<a id="__codelineno-17-21" name="__codelineno-17-21"></a>
<a id="__codelineno-17-22" name="__codelineno-17-22"></a><span class="k">class</span> <span class="nc">MessageStream</span><span class="p">(</span><span class="n">Stream</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
<a id="__codelineno-17-23" name="__codelineno-17-23"></a>    <span class="k">def</span> <span class="nf">receive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-17-24" name="__codelineno-17-24"></a>        <span class="o">...</span>
<a id="__codelineno-17-25" name="__codelineno-17-25"></a>
<a id="__codelineno-17-26" name="__codelineno-17-26"></a>    <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-17-27" name="__codelineno-17-27"></a>        <span class="o">...</span>
<a id="__codelineno-17-28" name="__codelineno-17-28"></a>
<a id="__codelineno-17-29" name="__codelineno-17-29"></a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-17-30" name="__codelineno-17-30"></a>        <span class="o">...</span>
<a id="__codelineno-17-31" name="__codelineno-17-31"></a>
<a id="__codelineno-17-32" name="__codelineno-17-32"></a>    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-17-33" name="__codelineno-17-33"></a>        <span class="o">...</span>
</code></pre></div></td></tr></table></div>
<p><code>m = MessageStream()</code></p>
<p><code>isinstance(m, Stream)     # -&gt; True</code></p>
<p><code>isinstance(m, Iterable)   # -&gt; True</code></p>
<h2 id="mixin-classes">Mixin Classes</h2>
<p>The other use of multiple inheritance is to define mixin classes. A mixin class is a class that modifies or extends the functionality of other classes. Consider the following class definitions:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-18-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-18-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-18-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-18-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-18-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-18-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-18-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-18-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-18-10">10</a></span>
<span class="normal"><a href="#__codelineno-18-11">11</a></span>
<span class="normal"><a href="#__codelineno-18-12">12</a></span>
<span class="normal"><a href="#__codelineno-18-13">13</a></span>
<span class="normal"><a href="#__codelineno-18-14">14</a></span>
<span class="normal"><a href="#__codelineno-18-15">15</a></span>
<span class="normal"><a href="#__codelineno-18-16">16</a></span>
<span class="normal"><a href="#__codelineno-18-17">17</a></span>
<span class="normal"><a href="#__codelineno-18-18">18</a></span>
<span class="normal"><a href="#__codelineno-18-19">19</a></span>
<span class="normal"><a href="#__codelineno-18-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="k">class</span> <span class="nc">Duck</span><span class="p">:</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a>    <span class="k">def</span> <span class="nf">noise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a>        <span class="k">return</span> <span class="s1">&#39;Quack&#39;</span>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a>    <span class="k">def</span> <span class="nf">waddle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-18-6" name="__codelineno-18-6"></a>        <span class="k">return</span> <span class="s1">&#39;Waddle&#39;</span>
<a id="__codelineno-18-7" name="__codelineno-18-7"></a>
<a id="__codelineno-18-8" name="__codelineno-18-8"></a><span class="k">class</span> <span class="nc">Trombonist</span><span class="p">:</span>
<a id="__codelineno-18-9" name="__codelineno-18-9"></a>    <span class="k">def</span> <span class="nf">noise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-18-10" name="__codelineno-18-10"></a>        <span class="k">return</span> <span class="s1">&#39;Blat!&#39;</span>
<a id="__codelineno-18-11" name="__codelineno-18-11"></a>
<a id="__codelineno-18-12" name="__codelineno-18-12"></a>    <span class="k">def</span> <span class="nf">march</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-18-13" name="__codelineno-18-13"></a>        <span class="k">return</span> <span class="s1">&#39;Clomp&#39;</span>
<a id="__codelineno-18-14" name="__codelineno-18-14"></a>
<a id="__codelineno-18-15" name="__codelineno-18-15"></a><span class="k">class</span> <span class="nc">Cyclist</span><span class="p">:</span>
<a id="__codelineno-18-16" name="__codelineno-18-16"></a>    <span class="k">def</span> <span class="nf">noise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-18-17" name="__codelineno-18-17"></a>        <span class="k">return</span> <span class="s1">&#39;On your left!&#39;</span>
<a id="__codelineno-18-18" name="__codelineno-18-18"></a>
<a id="__codelineno-18-19" name="__codelineno-18-19"></a>    <span class="k">def</span> <span class="nf">pedal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-18-20" name="__codelineno-18-20"></a>        <span class="k">return</span> <span class="s1">&#39;Pedaling&#39;</span>
</code></pre></div></td></tr></table></div>
<p>These classes are completely unrelated to each other. There is no inheritance relationship and they implement different methods. However, there is a shared commonality in that they each define a <code>noise()</code> method. Using that as a guide, you could define the following classes:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-19-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-19-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-19-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-19-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-19-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-19-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-19-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-19-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-19-10">10</a></span>
<span class="normal"><a href="#__codelineno-19-11">11</a></span>
<span class="normal"><a href="#__codelineno-19-12">12</a></span>
<span class="normal"><a href="#__codelineno-19-13">13</a></span>
<span class="normal"><a href="#__codelineno-19-14">14</a></span>
<span class="normal"><a href="#__codelineno-19-15">15</a></span>
<span class="normal"><a href="#__codelineno-19-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="k">class</span> <span class="nc">LoudMixin</span><span class="p">:</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a>    <span class="k">def</span> <span class="nf">noise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">noise</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a>
<a id="__codelineno-19-5" name="__codelineno-19-5"></a><span class="k">class</span> <span class="nc">AnnoyingMixin</span><span class="p">:</span>
<a id="__codelineno-19-6" name="__codelineno-19-6"></a>    <span class="k">def</span> <span class="nf">noise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-19-7" name="__codelineno-19-7"></a>        <span class="k">return</span> <span class="mi">3</span> <span class="o">*</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">noise</span><span class="p">()</span>
<a id="__codelineno-19-8" name="__codelineno-19-8"></a>
<a id="__codelineno-19-9" name="__codelineno-19-9"></a><span class="k">class</span> <span class="nc">LoudDuck</span><span class="p">(</span><span class="n">LoudMixin</span><span class="p">,</span> <span class="n">Duck</span><span class="p">):</span>
<a id="__codelineno-19-10" name="__codelineno-19-10"></a>    <span class="k">pass</span>
<a id="__codelineno-19-11" name="__codelineno-19-11"></a>
<a id="__codelineno-19-12" name="__codelineno-19-12"></a><span class="k">class</span> <span class="nc">AnnoyingTrombonist</span><span class="p">(</span><span class="n">AnnoyingMixin</span><span class="p">,</span> <span class="n">Trombonist</span><span class="p">):</span>
<a id="__codelineno-19-13" name="__codelineno-19-13"></a>    <span class="k">pass</span>
<a id="__codelineno-19-14" name="__codelineno-19-14"></a>
<a id="__codelineno-19-15" name="__codelineno-19-15"></a><span class="k">class</span> <span class="nc">AnnoyingLoudCyclist</span><span class="p">(</span><span class="n">AnnoyingMixin</span><span class="p">,</span> <span class="n">LoudMixin</span><span class="p">,</span> <span class="n">Cyclist</span><span class="p">):</span>
<a id="__codelineno-19-16" name="__codelineno-19-16"></a>    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
<p><code>d = LoudDuck()</code></p>
<p><code>d.noise()  # -&gt; 'QUACK'</code></p>
<p><code>t = AnnoyingTrombonist()</code></p>
<p><code>t.noise()  # -&gt; 'Blat!Blat!Blat!'</code></p>
<p><code>c = AnnoyingLoudCyclist()</code></p>
<p><code>c.noise()  # -&gt; 'ON YOUR LEFT!ON YOUR LEFT!ON YOUR LEFT!'</code></p>
<p>Since mixin classes are defined in the same way as normal classes, it is best to include the word "Mixin" as part of the class name. This naming convention provides a greater clarity of purpose.</p>
<p>To fully understand mixins, you need to know a bit more about how inheritance and the <code>super()</code> function work.</p>
<p>First, whenever you use inheritance, Python builds a linear chain of classes known as the Method Resolution Order, or MRO for short. This is available as the <code>mro</code> attribute on a class. Here are some examples for single inheritance:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-20-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-20-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-20-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-20-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-20-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-20-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-20-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-20-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-20-10">10</a></span>
<span class="normal"><a href="#__codelineno-20-11">11</a></span>
<span class="normal"><a href="#__codelineno-20-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="k">class</span> <span class="nc">Base</span><span class="p">:</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a>    <span class="k">pass</span>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a>
<a id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<a id="__codelineno-20-5" name="__codelineno-20-5"></a>    <span class="k">pass</span>
<a id="__codelineno-20-6" name="__codelineno-20-6"></a>
<a id="__codelineno-20-7" name="__codelineno-20-7"></a><span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
<a id="__codelineno-20-8" name="__codelineno-20-8"></a>    <span class="k">pass</span>
<a id="__codelineno-20-9" name="__codelineno-20-9"></a>
<a id="__codelineno-20-10" name="__codelineno-20-10"></a><span class="n">Base</span><span class="o">.</span><span class="vm">__mro__</span>  <span class="c1"># -&gt; (&lt;class &#39;Base&#39;&gt;, &lt;class &#39;object&#39;&gt;)</span>
<a id="__codelineno-20-11" name="__codelineno-20-11"></a><span class="n">A</span><span class="o">.</span><span class="vm">__mro__</span>     <span class="c1"># -&gt; (&lt;class &#39;A&#39;&gt;, &lt;class &#39;Base&#39;&gt;, &lt;class &#39;object&#39;&gt;)</span>
<a id="__codelineno-20-12" name="__codelineno-20-12"></a><span class="n">B</span><span class="o">.</span><span class="vm">__mro__</span>     <span class="c1"># -&gt; (&lt;class &#39;B&#39;&gt;, &lt;class &#39;A&#39;&gt;, &lt;class &#39;Base&#39;&gt;, &lt;class &#39;object&#39;&gt;)</span>
</code></pre></div></td></tr></table></div>
<h1 id="class-decorators-and-class-methods">Class Decorators and Class Methods</h1>
<h2 id="factory-function-that-uses-the-registry">Factory function that uses the registry</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1">1</a></span>
<span class="normal"><a href="#__codelineno-21-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="k">def</span> <span class="nf">create_decoder</span><span class="p">(</span><span class="n">mimetype</span><span class="p">):</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a>    <span class="k">return</span> <span class="n">_registry</span><span class="p">[</span><span class="n">mimetype</span><span class="p">]()</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1">1</a></span>
<span class="normal"><a href="#__codelineno-22-2">2</a></span>
<span class="normal"><a href="#__codelineno-22-3">3</a></span>
<span class="normal"><a href="#__codelineno-22-4">4</a></span>
<span class="normal"><a href="#__codelineno-22-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="nd">@register_decoder</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="k">class</span> <span class="nc">TextDecoder</span><span class="p">:</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a>    <span class="n">mimetypes</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;text/plain&#39;</span> <span class="p">]</span>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a>    <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<a id="__codelineno-22-5" name="__codelineno-22-5"></a>        <span class="o">...</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1">1</a></span>
<span class="normal"><a href="#__codelineno-23-2">2</a></span>
<span class="normal"><a href="#__codelineno-23-3">3</a></span>
<span class="normal"><a href="#__codelineno-23-4">4</a></span>
<span class="normal"><a href="#__codelineno-23-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="nd">@register_decoder</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="k">class</span> <span class="nc">HTMLDecoder</span><span class="p">:</span>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a>    <span class="n">mimetypes</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;text/html&#39;</span> <span class="p">]</span>
<a id="__codelineno-23-4" name="__codelineno-23-4"></a>    <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<a id="__codelineno-23-5" name="__codelineno-23-5"></a>        <span class="o">...</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1">1</a></span>
<span class="normal"><a href="#__codelineno-24-2">2</a></span>
<span class="normal"><a href="#__codelineno-24-3">3</a></span>
<span class="normal"><a href="#__codelineno-24-4">4</a></span>
<span class="normal"><a href="#__codelineno-24-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="nd">@register_decoder</span>
<a id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="k">class</span> <span class="nc">ImageDecoder</span><span class="p">:</span>
<a id="__codelineno-24-3" name="__codelineno-24-3"></a>    <span class="n">mimetypes</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;image/png&#39;</span><span class="p">,</span> <span class="s1">&#39;image/jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;image/gif&#39;</span> <span class="p">]</span>
<a id="__codelineno-24-4" name="__codelineno-24-4"></a>    <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<a id="__codelineno-24-5" name="__codelineno-24-5"></a>        <span class="o">...</span>
</code></pre></div></td></tr></table></div>
<h2 id="example-usage">Example usage</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="n">decoder</span> <span class="o">=</span> <span class="n">create_decoder</span><span class="p">(</span><span class="s1">&#39;image/jpg&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>A class decorator is free to modify the contents of the class it’s given. For example, it might even rewrite existing methods. This is a common alternative to mixin classes or multiple inheritance. For example, consider these decorators:</p>
<h3 id="decorator-override-function">decorator override function</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-26-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-26-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-26-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-26-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-26-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-26-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-26-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-26-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-26-10">10</a></span>
<span class="normal"><a href="#__codelineno-26-11">11</a></span>
<span class="normal"><a href="#__codelineno-26-12">12</a></span>
<span class="normal"><a href="#__codelineno-26-13">13</a></span>
<span class="normal"><a href="#__codelineno-26-14">14</a></span>
<span class="normal"><a href="#__codelineno-26-15">15</a></span>
<span class="normal"><a href="#__codelineno-26-16">16</a></span>
<span class="normal"><a href="#__codelineno-26-17">17</a></span>
<span class="normal"><a href="#__codelineno-26-18">18</a></span>
<span class="normal"><a href="#__codelineno-26-19">19</a></span>
<span class="normal"><a href="#__codelineno-26-20">20</a></span>
<span class="normal"><a href="#__codelineno-26-21">21</a></span>
<span class="normal"><a href="#__codelineno-26-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="k">def</span> <span class="nf">loud</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<a id="__codelineno-26-2" name="__codelineno-26-2"></a>    <span class="n">orig_noise</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">noise</span>
<a id="__codelineno-26-3" name="__codelineno-26-3"></a>    <span class="k">def</span> <span class="nf">noise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-26-4" name="__codelineno-26-4"></a>        <span class="k">return</span> <span class="n">orig_noise</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<a id="__codelineno-26-5" name="__codelineno-26-5"></a>    <span class="bp">cls</span><span class="o">.</span><span class="n">noise</span> <span class="o">=</span> <span class="n">noise</span>
<a id="__codelineno-26-6" name="__codelineno-26-6"></a>    <span class="k">return</span> <span class="bp">cls</span>
<a id="__codelineno-26-7" name="__codelineno-26-7"></a>
<a id="__codelineno-26-8" name="__codelineno-26-8"></a><span class="k">def</span> <span class="nf">annoying</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<a id="__codelineno-26-9" name="__codelineno-26-9"></a>    <span class="n">orig_noise</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">noise</span>
<a id="__codelineno-26-10" name="__codelineno-26-10"></a>    <span class="k">def</span> <span class="nf">noise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-26-11" name="__codelineno-26-11"></a>        <span class="k">return</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">orig_noise</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<a id="__codelineno-26-12" name="__codelineno-26-12"></a>    <span class="bp">cls</span><span class="o">.</span><span class="n">noise</span> <span class="o">=</span> <span class="n">noise</span>
<a id="__codelineno-26-13" name="__codelineno-26-13"></a>    <span class="k">return</span> <span class="bp">cls</span>
<a id="__codelineno-26-14" name="__codelineno-26-14"></a>
<a id="__codelineno-26-15" name="__codelineno-26-15"></a><span class="nd">@annoying</span>
<a id="__codelineno-26-16" name="__codelineno-26-16"></a><span class="nd">@loud</span>
<a id="__codelineno-26-17" name="__codelineno-26-17"></a><span class="k">class</span> <span class="nc">Cyclist</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a id="__codelineno-26-18" name="__codelineno-26-18"></a>    <span class="k">def</span> <span class="nf">noise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-26-19" name="__codelineno-26-19"></a>        <span class="k">return</span> <span class="s1">&#39;On your left!&#39;</span>
<a id="__codelineno-26-20" name="__codelineno-26-20"></a>
<a id="__codelineno-26-21" name="__codelineno-26-21"></a>    <span class="k">def</span> <span class="nf">pedal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-26-22" name="__codelineno-26-22"></a>        <span class="k">return</span> <span class="s1">&#39;Pedaling&#39;</span>
</code></pre></div></td></tr></table></div>
<h3 id="add-code-to-class-at-runtime">Add code to class at runtime</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1">1</a></span>
<span class="normal"><a href="#__codelineno-27-2">2</a></span>
<span class="normal"><a href="#__codelineno-27-3">3</a></span>
<span class="normal"><a href="#__codelineno-27-4">4</a></span>
<span class="normal"><a href="#__codelineno-27-5">5</a></span>
<span class="normal"><a href="#__codelineno-27-6">6</a></span>
<span class="normal"><a href="#__codelineno-27-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="k">class</span> <span class="nc">Point</span><span class="p">:</span>
<a id="__codelineno-27-2" name="__codelineno-27-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<a id="__codelineno-27-3" name="__codelineno-27-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
<a id="__codelineno-27-4" name="__codelineno-27-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
<a id="__codelineno-27-5" name="__codelineno-27-5"></a>
<a id="__codelineno-27-6" name="__codelineno-27-6"></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-27-7" name="__codelineno-27-7"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="si">!r}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="si">!r}</span><span class="s1">)&#39;</span>
</code></pre></div></td></tr></table></div>
<p>Writing such methods is often annoying. Perhaps a class decorator could create the method for you?</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-28-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-28-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-28-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-28-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-28-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-28-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-28-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-28-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-28-10">10</a></span>
<span class="normal"><a href="#__codelineno-28-11">11</a></span>
<span class="normal"><a href="#__codelineno-28-12">12</a></span>
<span class="normal"><a href="#__codelineno-28-13">13</a></span>
<span class="normal"><a href="#__codelineno-28-14">14</a></span>
<span class="normal"><a href="#__codelineno-28-15">15</a></span>
<span class="normal"><a href="#__codelineno-28-16">16</a></span>
<span class="normal"><a href="#__codelineno-28-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="kn">import</span> <span class="nn">inspect</span>
<a id="__codelineno-28-2" name="__codelineno-28-2"></a><span class="k">def</span> <span class="nf">with_repr</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<a id="__codelineno-28-3" name="__codelineno-28-3"></a>    <span class="n">args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
<a id="__codelineno-28-4" name="__codelineno-28-4"></a>    <span class="n">argvals</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;{self.</span><span class="si">%s</span><span class="s1">!r}&#39;</span> <span class="o">%</span> <span class="n">arg</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">)</span>
<a id="__codelineno-28-5" name="__codelineno-28-5"></a>    <span class="n">code</span> <span class="o">=</span> <span class="s1">&#39;def __repr__(self):</span><span class="se">\n</span><span class="s1">&#39;</span>
<a id="__codelineno-28-6" name="__codelineno-28-6"></a>    <span class="n">code</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39; return f&#39;</span><span class="p">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">}({</span><span class="n">argvals</span><span class="p">})</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
<a id="__codelineno-28-7" name="__codelineno-28-7"></a>    <span class="n">locs</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>
<a id="__codelineno-28-8" name="__codelineno-28-8"></a>    <span class="n">exec</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">locs</span><span class="p">)</span>
<a id="__codelineno-28-9" name="__codelineno-28-9"></a>    <span class="bp">cls</span><span class="o">.</span><span class="fm">__repr__</span> <span class="o">=</span> <span class="n">locs</span><span class="p">[</span><span class="s1">&#39;__repr__&#39;</span><span class="p">]</span>
<a id="__codelineno-28-10" name="__codelineno-28-10"></a>    <span class="k">return</span> <span class="bp">cls</span>
<a id="__codelineno-28-11" name="__codelineno-28-11"></a>
<a id="__codelineno-28-12" name="__codelineno-28-12"></a><span class="c1"># Example</span>
<a id="__codelineno-28-13" name="__codelineno-28-13"></a><span class="nd">@with_repr</span>
<a id="__codelineno-28-14" name="__codelineno-28-14"></a><span class="k">class</span> <span class="nc">Point</span><span class="p">:</span>
<a id="__codelineno-28-15" name="__codelineno-28-15"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<a id="__codelineno-28-16" name="__codelineno-28-16"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
<a id="__codelineno-28-17" name="__codelineno-28-17"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
</code></pre></div></td></tr></table></div>
<p>In this example, a repr() method is generated from the calling signature of the init() method. The method is created as a text string and passed to exec() to create a function. That function is attached to the class.</p>
<p>Similar code generation techniques are used in parts of the standard library. For example, a convenient way to define data structures is to use a dataclass:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1">1</a></span>
<span class="normal"><a href="#__codelineno-29-2">2</a></span>
<span class="normal"><a href="#__codelineno-29-3">3</a></span>
<span class="normal"><a href="#__codelineno-29-4">4</a></span>
<span class="normal"><a href="#__codelineno-29-5">5</a></span>
<span class="normal"><a href="#__codelineno-29-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<a id="__codelineno-29-2" name="__codelineno-29-2"></a>
<a id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="nd">@dataclass</span>
<a id="__codelineno-29-4" name="__codelineno-29-4"></a><span class="k">class</span> <span class="nc">Point</span><span class="p">:</span>
<a id="__codelineno-29-5" name="__codelineno-29-5"></a>    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span>
<a id="__codelineno-29-6" name="__codelineno-29-6"></a>    <span class="n">y</span><span class="p">:</span> <span class="nb">int</span>
</code></pre></div></td></tr></table></div>
<p>A dataclass automatically creates methods such as <strong>init</strong>() and <strong>repr</strong>() from class type hints. The methods are created using exec(), similarly to the prior example. Here’s how the resulting Point class works:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1">1</a></span>
<span class="normal"><a href="#__codelineno-30-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="n">p</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-30-2" name="__codelineno-30-2"></a><span class="n">p</span>
</code></pre></div></td></tr></table></div>
<p>Output:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a>Point(x=2, y=3)
</code></pre></div></td></tr></table></div></p>
<p>One downside of such an approach is poor startup performance. Dynamically creating code with <code>exec()</code> bypasses the compilation optimizations that Python normally applies to modules. Defining a large number of classes in this way may therefore significantly slow down the importing of your code.</p>
<h2 id="supervised-inheritance-__init_subclass__">Supervised Inheritance - <code>__init_subclass__</code></h2>
<p>As you saw in the previous section, sometimes you want to define a class and perform additional actions. A class decorator is one mechanism for doing this. However, a parent class can also perform extra actions on behalf of its subclasses. This is accomplished by implementing an <code>__init_subclass__(cls)</code> class method. For example:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-32-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-32-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-32-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-32-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-32-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-32-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-32-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-32-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-32-10">10</a></span>
<span class="normal"><a href="#__codelineno-32-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="k">class</span> <span class="nc">Base</span><span class="p">:</span>
<a id="__codelineno-32-2" name="__codelineno-32-2"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-32-3" name="__codelineno-32-3"></a>    <span class="k">def</span> <span class="nf">__init_subclass__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<a id="__codelineno-32-4" name="__codelineno-32-4"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Initializing&#39;</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span>
<a id="__codelineno-32-5" name="__codelineno-32-5"></a>
<a id="__codelineno-32-6" name="__codelineno-32-6"></a><span class="c1"># Example (should see &#39;Initializing&#39; message for each class)</span>
<a id="__codelineno-32-7" name="__codelineno-32-7"></a><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<a id="__codelineno-32-8" name="__codelineno-32-8"></a>    <span class="k">pass</span>
<a id="__codelineno-32-9" name="__codelineno-32-9"></a>
<a id="__codelineno-32-10" name="__codelineno-32-10"></a><span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
<a id="__codelineno-32-11" name="__codelineno-32-11"></a>    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
<p>If an <code>__init_subclass__()</code> method is present, it is triggered automatically upon the definition of any child class. This happens even if the child is buried deeply in an inheritance hierarchy.</p>
<p>Many of the tasks commonly performed with class decorators can be performed with <code>__init_subclass__()</code> instead. For example, class registration:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-33-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-33-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-33-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-33-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-33-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-33-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-33-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-33-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-33-10">10</a></span>
<span class="normal"><a href="#__codelineno-33-11">11</a></span>
<span class="normal"><a href="#__codelineno-33-12">12</a></span>
<span class="normal"><a href="#__codelineno-33-13">13</a></span>
<span class="normal"><a href="#__codelineno-33-14">14</a></span>
<span class="normal"><a href="#__codelineno-33-15">15</a></span>
<span class="normal"><a href="#__codelineno-33-16">16</a></span>
<span class="normal"><a href="#__codelineno-33-17">17</a></span>
<span class="normal"><a href="#__codelineno-33-18">18</a></span>
<span class="normal"><a href="#__codelineno-33-19">19</a></span>
<span class="normal"><a href="#__codelineno-33-20">20</a></span>
<span class="normal"><a href="#__codelineno-33-21">21</a></span>
<span class="normal"><a href="#__codelineno-33-22">22</a></span>
<span class="normal"><a href="#__codelineno-33-23">23</a></span>
<span class="normal"><a href="#__codelineno-33-24">24</a></span>
<span class="normal"><a href="#__codelineno-33-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="k">class</span> <span class="nc">DecoderBase</span><span class="p">:</span>
<a id="__codelineno-33-2" name="__codelineno-33-2"></a>    <span class="n">_registry</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>
<a id="__codelineno-33-3" name="__codelineno-33-3"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-33-4" name="__codelineno-33-4"></a>    <span class="k">def</span> <span class="nf">__init_subclass__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<a id="__codelineno-33-5" name="__codelineno-33-5"></a>        <span class="k">for</span> <span class="n">mt</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">mimetypes</span><span class="p">:</span>
<a id="__codelineno-33-6" name="__codelineno-33-6"></a>            <span class="n">DecoderBase</span><span class="o">.</span><span class="n">_registry</span><span class="p">[</span><span class="n">mt</span><span class="o">.</span><span class="n">mimetype</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span>
<a id="__codelineno-33-7" name="__codelineno-33-7"></a>
<a id="__codelineno-33-8" name="__codelineno-33-8"></a><span class="c1"># Factory function that uses the registry</span>
<a id="__codelineno-33-9" name="__codelineno-33-9"></a><span class="k">def</span> <span class="nf">create_decoder</span><span class="p">(</span><span class="n">mimetype</span><span class="p">):</span>
<a id="__codelineno-33-10" name="__codelineno-33-10"></a>    <span class="k">return</span> <span class="n">DecoderBase</span><span class="o">.</span><span class="n">_registry</span><span class="p">[</span><span class="n">mimetype</span><span class="p">]()</span>
<a id="__codelineno-33-11" name="__codelineno-33-11"></a>
<a id="__codelineno-33-12" name="__codelineno-33-12"></a><span class="k">class</span> <span class="nc">TextDecoder</span><span class="p">(</span><span class="n">DecoderBase</span><span class="p">):</span>
<a id="__codelineno-33-13" name="__codelineno-33-13"></a>    <span class="n">mimetypes</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;text/plain&#39;</span> <span class="p">]</span>
<a id="__codelineno-33-14" name="__codelineno-33-14"></a>    <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<a id="__codelineno-33-15" name="__codelineno-33-15"></a>        <span class="o">...</span>
<a id="__codelineno-33-16" name="__codelineno-33-16"></a>
<a id="__codelineno-33-17" name="__codelineno-33-17"></a><span class="k">class</span> <span class="nc">HTMLDecoder</span><span class="p">(</span><span class="n">DecoderBase</span><span class="p">):</span>
<a id="__codelineno-33-18" name="__codelineno-33-18"></a>    <span class="n">mimetypes</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;text/html&#39;</span> <span class="p">]</span>
<a id="__codelineno-33-19" name="__codelineno-33-19"></a>    <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<a id="__codelineno-33-20" name="__codelineno-33-20"></a>        <span class="o">...</span>
<a id="__codelineno-33-21" name="__codelineno-33-21"></a>
<a id="__codelineno-33-22" name="__codelineno-33-22"></a><span class="k">class</span> <span class="nc">ImageDecoder</span><span class="p">(</span><span class="n">DecoderBase</span><span class="p">):</span>
<a id="__codelineno-33-23" name="__codelineno-33-23"></a>    <span class="n">mimetypes</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;image/png&#39;</span><span class="p">,</span> <span class="s1">&#39;image/jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;image/gif&#39;</span> <span class="p">]</span>
<a id="__codelineno-33-24" name="__codelineno-33-24"></a>    <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<a id="__codelineno-33-25" name="__codelineno-33-25"></a>        <span class="o">...</span>
</code></pre></div></td></tr></table></div>
<h2 id="class-initialization-with-__repr__">Class Initialization with <code>__repr__</code></h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-34-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-34-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-34-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-34-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-34-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-34-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-34-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-34-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-34-10">10</a></span>
<span class="normal"><a href="#__codelineno-34-11">11</a></span>
<span class="normal"><a href="#__codelineno-34-12">12</a></span>
<span class="normal"><a href="#__codelineno-34-13">13</a></span>
<span class="normal"><a href="#__codelineno-34-14">14</a></span>
<span class="normal"><a href="#__codelineno-34-15">15</a></span>
<span class="normal"><a href="#__codelineno-34-16">16</a></span>
<span class="normal"><a href="#__codelineno-34-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="kn">import</span> <span class="nn">inspect</span>
<a id="__codelineno-34-2" name="__codelineno-34-2"></a><span class="k">class</span> <span class="nc">Base</span><span class="p">:</span>
<a id="__codelineno-34-3" name="__codelineno-34-3"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-34-4" name="__codelineno-34-4"></a>    <span class="k">def</span> <span class="nf">__init_subclass__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<a id="__codelineno-34-5" name="__codelineno-34-5"></a>        <span class="c1"># Create a __repr__ method</span>
<a id="__codelineno-34-6" name="__codelineno-34-6"></a>        <span class="n">args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
<a id="__codelineno-34-7" name="__codelineno-34-7"></a>        <span class="n">argvals</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;{self.</span><span class="si">%s</span><span class="s1">!r}&#39;</span> <span class="o">%</span> <span class="n">arg</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">)</span>
<a id="__codelineno-34-8" name="__codelineno-34-8"></a>        <span class="n">code</span> <span class="o">=</span> <span class="s1">&#39;def __repr__(self):</span><span class="se">\n</span><span class="s1">&#39;</span>
<a id="__codelineno-34-9" name="__codelineno-34-9"></a>        <span class="n">code</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39; return f&#39;</span><span class="p">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">}({</span><span class="n">argvals</span><span class="p">})</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
<a id="__codelineno-34-10" name="__codelineno-34-10"></a>        <span class="n">locs</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>
<a id="__codelineno-34-11" name="__codelineno-34-11"></a>        <span class="n">exec</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">locs</span><span class="p">)</span>
<a id="__codelineno-34-12" name="__codelineno-34-12"></a>        <span class="bp">cls</span><span class="o">.</span><span class="fm">__repr__</span> <span class="o">=</span> <span class="n">locs</span><span class="p">[</span><span class="s1">&#39;__repr__&#39;</span><span class="p">]</span>
<a id="__codelineno-34-13" name="__codelineno-34-13"></a>
<a id="__codelineno-34-14" name="__codelineno-34-14"></a><span class="k">class</span> <span class="nc">Point</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<a id="__codelineno-34-15" name="__codelineno-34-15"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<a id="__codelineno-34-16" name="__codelineno-34-16"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
<a id="__codelineno-34-17" name="__codelineno-34-17"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
</code></pre></div></td></tr></table></div>
<p>If multiple inheritance is being used, you should use <code>super()</code> to make sure all classes that implement <code>__init_subclass__()</code> get called. For example:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-35-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-35-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-35-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-35-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-35-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-35-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-35-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-35-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-35-10">10</a></span>
<span class="normal"><a href="#__codelineno-35-11">11</a></span>
<span class="normal"><a href="#__codelineno-35-12">12</a></span>
<span class="normal"><a href="#__codelineno-35-13">13</a></span>
<span class="normal"><a href="#__codelineno-35-14">14</a></span>
<span class="normal"><a href="#__codelineno-35-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
<a id="__codelineno-35-2" name="__codelineno-35-2"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-35-3" name="__codelineno-35-3"></a>    <span class="k">def</span> <span class="nf">__init_subclass__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<a id="__codelineno-35-4" name="__codelineno-35-4"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;A.init_subclass&#39;</span><span class="p">)</span>
<a id="__codelineno-35-5" name="__codelineno-35-5"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init_subclass__</span><span class="p">()</span>
<a id="__codelineno-35-6" name="__codelineno-35-6"></a>
<a id="__codelineno-35-7" name="__codelineno-35-7"></a><span class="k">class</span> <span class="nc">B</span><span class="p">:</span>
<a id="__codelineno-35-8" name="__codelineno-35-8"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-35-9" name="__codelineno-35-9"></a>    <span class="k">def</span> <span class="nf">__init_subclass__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<a id="__codelineno-35-10" name="__codelineno-35-10"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;B.init_subclass&#39;</span><span class="p">)</span>
<a id="__codelineno-35-11" name="__codelineno-35-11"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init_subclass__</span><span class="p">()</span>
<a id="__codelineno-35-12" name="__codelineno-35-12"></a>
<a id="__codelineno-35-13" name="__codelineno-35-13"></a><span class="c1"># Should see output from both classes here</span>
<a id="__codelineno-35-14" name="__codelineno-35-14"></a><span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
<a id="__codelineno-35-15" name="__codelineno-35-15"></a>    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
<h2 id="object-life-cycle-and-memory-management">Object Life Cycle and Memory Management</h2>
<p>When a class is defined, the resulting class is a factory for creating new instances. For example:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-36-1">1</a></span>
<span class="normal"><a href="#__codelineno-36-2">2</a></span>
<span class="normal"><a href="#__codelineno-36-3">3</a></span>
<span class="normal"><a href="#__codelineno-36-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="k">class</span> <span class="nc">Account</span><span class="p">:</span>
<a id="__codelineno-36-2" name="__codelineno-36-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">balance</span><span class="p">):</span>
<a id="__codelineno-36-3" name="__codelineno-36-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">owner</span>
<a id="__codelineno-36-4" name="__codelineno-36-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">=</span> <span class="n">balance</span>
</code></pre></div></td></tr></table></div>
<p>Create some <code>Account</code> instances:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-1">1</a></span>
<span class="normal"><a href="#__codelineno-37-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="n">a</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="s1">&#39;Guido&#39;</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">)</span>
<a id="__codelineno-37-2" name="__codelineno-37-2"></a><span class="n">b</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="s1">&#39;Eva&#39;</span><span class="p">,</span> <span class="mf">25.0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div></p>
<p>The creation of an instance is carried out in two steps using the special method <code>__new__()</code> that creates a new instance and <code>__init__()</code> that initializes it. For example, the operation <code>a = Account('Guido', 1000.0)</code> performs these steps:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-38-1">1</a></span>
<span class="normal"><a href="#__codelineno-38-2">2</a></span>
<span class="normal"><a href="#__codelineno-38-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1"></a><span class="n">a</span> <span class="o">=</span> <span class="n">Account</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">Account</span><span class="p">,</span> <span class="s1">&#39;Guido&#39;</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">)</span>
<a id="__codelineno-38-2" name="__codelineno-38-2"></a><span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">Account</span><span class="p">):</span>
<a id="__codelineno-38-3" name="__codelineno-38-3"></a>    <span class="n">Account</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;Guido&#39;</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>Except for the first argument which is the class instead of an instance, <code>__new__()</code> normally receives the same arguments as <code>__init__()</code>. However, the default implementation of <code>__new__()</code> just ignores them. You’ll sometimes see <code>__new__()</code> invoked with just a single argument. For example, this code also works:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-39-1">1</a></span>
<span class="normal"><a href="#__codelineno-39-2">2</a></span>
<span class="normal"><a href="#__codelineno-39-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="n">a</span> <span class="o">=</span> <span class="n">Account</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">Account</span><span class="p">)</span>
<a id="__codelineno-39-2" name="__codelineno-39-2"></a><span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">Account</span><span class="p">):</span>
<a id="__codelineno-39-3" name="__codelineno-39-3"></a>    <span class="n">Account</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;Guido&#39;</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>Direct use of the <code>__new__()</code> method is uncommon, but sometimes it’s used to create instances while bypassing the invocation of the <code>__init__()</code> method. One such use is in class methods.
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-40-1">1</a></span>
<span class="normal"><a href="#__codelineno-40-2">2</a></span>
<span class="normal"><a href="#__codelineno-40-3">3</a></span>
<span class="normal"><a href="#__codelineno-40-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1"></a><span class="k">class</span> <span class="nc">Spam</span><span class="p">:</span>
<a id="__codelineno-40-2" name="__codelineno-40-2"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-40-3" name="__codelineno-40-3"></a>    <span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-40-4" name="__codelineno-40-4"></a>        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-41-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-41-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-41-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-41-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-41-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-41-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-41-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-41-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-41-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-41-10">10</a></span>
<span class="normal"><a href="#__codelineno-41-11">11</a></span>
<span class="normal"><a href="#__codelineno-41-12">12</a></span>
<span class="normal"><a href="#__codelineno-41-13">13</a></span>
<span class="normal"><a href="#__codelineno-41-14">14</a></span>
<span class="normal"><a href="#__codelineno-41-15">15</a></span>
<span class="normal"><a href="#__codelineno-41-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="kn">import</span> <span class="nn">time</span>
<a id="__codelineno-41-2" name="__codelineno-41-2"></a>
<a id="__codelineno-41-3" name="__codelineno-41-3"></a><span class="k">class</span> <span class="nc">Date</span><span class="p">:</span>
<a id="__codelineno-41-4" name="__codelineno-41-4"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">):</span>
<a id="__codelineno-41-5" name="__codelineno-41-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">year</span> <span class="o">=</span> <span class="n">year</span>
<a id="__codelineno-41-6" name="__codelineno-41-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">month</span> <span class="o">=</span> <span class="n">month</span>
<a id="__codelineno-41-7" name="__codelineno-41-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">day</span> <span class="o">=</span> <span class="n">day</span>
<a id="__codelineno-41-8" name="__codelineno-41-8"></a>
<a id="__codelineno-41-9" name="__codelineno-41-9"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-41-10" name="__codelineno-41-10"></a>    <span class="k">def</span> <span class="nf">today</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<a id="__codelineno-41-11" name="__codelineno-41-11"></a>        <span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">()</span>
<a id="__codelineno-41-12" name="__codelineno-41-12"></a>        <span class="bp">self</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>   <span class="c1"># Make instance</span>
<a id="__codelineno-41-13" name="__codelineno-41-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">year</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">tm_year</span>
<a id="__codelineno-41-14" name="__codelineno-41-14"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">month</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">tm_month</span>
<a id="__codelineno-41-15" name="__codelineno-41-15"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">day</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">tm_day</span>
<a id="__codelineno-41-16" name="__codelineno-41-16"></a>        <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
<p>Modules that perform object serialization such as <code>pickle</code> also utilize <code>new()</code> to recreate instances when objects are deserialized. This is done without ever invoking <code>init()</code>.</p>
<p>Sometimes a class will define <code>new()</code> if it wants to alter some aspect of instance creation. Typical applications include instance caching, singletons, and immutability. As an example, you might want <code>Date</code> class to perform date interning—that is, caching and reusing <code>Date</code> instances that have an identical year, month, and day. Here is one way that might be implemented:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-42-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-42-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-42-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-42-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-42-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-42-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-42-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-42-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-42-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-42-10">10</a></span>
<span class="normal"><a href="#__codelineno-42-11">11</a></span>
<span class="normal"><a href="#__codelineno-42-12">12</a></span>
<span class="normal"><a href="#__codelineno-42-13">13</a></span>
<span class="normal"><a href="#__codelineno-42-14">14</a></span>
<span class="normal"><a href="#__codelineno-42-15">15</a></span>
<span class="normal"><a href="#__codelineno-42-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1"></a><span class="k">class</span> <span class="nc">Date</span><span class="p">:</span>
<a id="__codelineno-42-2" name="__codelineno-42-2"></a>    <span class="n">_cache</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>
<a id="__codelineno-42-3" name="__codelineno-42-3"></a>
<a id="__codelineno-42-4" name="__codelineno-42-4"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-42-5" name="__codelineno-42-5"></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">):</span>
<a id="__codelineno-42-6" name="__codelineno-42-6"></a>        <span class="bp">self</span> <span class="o">=</span> <span class="n">Date</span><span class="o">.</span><span class="n">_cache</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">,</span><span class="n">day</span><span class="p">))</span>
<a id="__codelineno-42-7" name="__codelineno-42-7"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
<a id="__codelineno-42-8" name="__codelineno-42-8"></a>            <span class="bp">self</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
<a id="__codelineno-42-9" name="__codelineno-42-9"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">year</span> <span class="o">=</span> <span class="n">year</span>
<a id="__codelineno-42-10" name="__codelineno-42-10"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">month</span> <span class="o">=</span> <span class="n">month</span>
<a id="__codelineno-42-11" name="__codelineno-42-11"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">day</span> <span class="o">=</span> <span class="n">day</span>
<a id="__codelineno-42-12" name="__codelineno-42-12"></a>            <span class="n">Date</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">,</span><span class="n">day</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
<a id="__codelineno-42-13" name="__codelineno-42-13"></a>        <span class="k">return</span> <span class="bp">self</span>
<a id="__codelineno-42-14" name="__codelineno-42-14"></a>
<a id="__codelineno-42-15" name="__codelineno-42-15"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">):</span>
<a id="__codelineno-42-16" name="__codelineno-42-16"></a>        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
<p>In this example, the class keeps an internal dictionary of previously created <code>Date</code> instances. When creating a new <code>Date</code>, the cache is consulted first. If a match is found, that instance is returned. Otherwise, a new instance is created and initialized.</p>
<p>A subtle detail of this solution is the empty <code>init()</code> method. Even though instances are cached, every call to <code>Date()</code> still invokes <code>init()</code>. To avoid duplicated effort, the method simply does nothing—instance creation actually takes place in <code>new()</code> when an instance is created the first time.</p>
<p>There are ways to avoid the extra call to <code>init()</code> but it requires sneaky tricks. One way to avoid it is to have <code>new()</code> return an entirely different type instance—for example, one belonging to a different class. Another solution, described later, is to use a metaclass.</p>
<p>Once created, instances are managed by reference counting. If the reference count reaches zero, the instance is immediately destroyed. When the instance is about to be destroyed, the interpreter first looks for a <code>del()</code> method associated with the object and calls it. For example:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-43-1">1</a></span>
<span class="normal"><a href="#__codelineno-43-2">2</a></span>
<span class="normal"><a href="#__codelineno-43-3">3</a></span>
<span class="normal"><a href="#__codelineno-43-4">4</a></span>
<span class="normal"><a href="#__codelineno-43-5">5</a></span>
<span class="normal"><a href="#__codelineno-43-6">6</a></span>
<span class="normal"><a href="#__codelineno-43-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1"></a><span class="k">class</span> <span class="nc">Account</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a id="__codelineno-43-2" name="__codelineno-43-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">balance</span><span class="p">):</span>
<a id="__codelineno-43-3" name="__codelineno-43-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">owner</span>
<a id="__codelineno-43-4" name="__codelineno-43-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">=</span> <span class="n">balance</span>
<a id="__codelineno-43-5" name="__codelineno-43-5"></a>
<a id="__codelineno-43-6" name="__codelineno-43-6"></a>    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-43-7" name="__codelineno-43-7"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Deleting Account&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>Occasionally, a program will use the <code>del</code> statement to delete a reference to an object as shown. If this causes the reference count of the object to reach zero, the <code>del()</code> method is called. However, in general, the <code>del</code> statement doesn’t directly call <code>del()</code> because there may be other object references living elsewhere. There are many other ways that an object might be deleted—for example, reassignment of a variable name or a variable going out of scope in a function:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-44-1">1</a></span>
<span class="normal"><a href="#__codelineno-44-2">2</a></span>
<span class="normal"><a href="#__codelineno-44-3">3</a></span>
<span class="normal"><a href="#__codelineno-44-4">4</a></span>
<span class="normal"><a href="#__codelineno-44-5">5</a></span>
<span class="normal"><a href="#__codelineno-44-6">6</a></span>
<span class="normal"><a href="#__codelineno-44-7">7</a></span>
<span class="normal"><a href="#__codelineno-44-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="s1">&#39;Guido&#39;</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">)</span>
<a id="__codelineno-44-2" name="__codelineno-44-2"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">42</span>
<a id="__codelineno-44-3" name="__codelineno-44-3"></a><span class="n">Deleting</span> <span class="n">Account</span>
<a id="__codelineno-44-4" name="__codelineno-44-4"></a><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
<a id="__codelineno-44-5" name="__codelineno-44-5"></a><span class="o">...</span>     <span class="n">a</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="s1">&#39;Guido&#39;</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">)</span>
<a id="__codelineno-44-6" name="__codelineno-44-6"></a><span class="o">...</span>
<a id="__codelineno-44-7" name="__codelineno-44-7"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">func</span><span class="p">()</span>
<a id="__codelineno-44-8" name="__codelineno-44-8"></a><span class="n">Deleting</span> <span class="n">Account</span>
</code></pre></div></td></tr></table></div>
<p>In practice, it’s rarely necessary for a class to define a <code>del()</code> method. The only exception is when the destruction of an object requires an extra cleanup action—such as closing a file, shutting down a network connection, or releasing other system resources. Even in these cases, it’s dangerous to rely on <code>del()</code> for a proper shutdown because there’s no guarantee that this method will be called when you think it would. For clean shutdown of resources, you should give the object an explicit <code>close()</code> method. You should also make your class support the context manager protocol so it can be used with the <code>with</code> statement. Here is an example that covers all of the cases:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-45-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-45-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-45-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-45-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-45-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-45-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-45-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-45-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-45-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-45-10">10</a></span>
<span class="normal"><a href="#__codelineno-45-11">11</a></span>
<span class="normal"><a href="#__codelineno-45-12">12</a></span>
<span class="normal"><a href="#__codelineno-45-13">13</a></span>
<span class="normal"><a href="#__codelineno-45-14">14</a></span>
<span class="normal"><a href="#__codelineno-45-15">15</a></span>
<span class="normal"><a href="#__codelineno-45-16">16</a></span>
<span class="normal"><a href="#__codelineno-45-17">17</a></span>
<span class="normal"><a href="#__codelineno-45-18">18</a></span>
<span class="normal"><a href="#__codelineno-45-19">19</a></span>
<span class="normal"><a href="#__codelineno-45-20">20</a></span>
<span class="normal"><a href="#__codelineno-45-21">21</a></span>
<span class="normal"><a href="#__codelineno-45-22">22</a></span>
<span class="normal"><a href="#__codelineno-45-23">23</a></span>
<span class="normal"><a href="#__codelineno-45-24">24</a></span>
<span class="normal"><a href="#__codelineno-45-25">25</a></span>
<span class="normal"><a href="#__codelineno-45-26">26</a></span>
<span class="normal"><a href="#__codelineno-45-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1"></a><span class="k">class</span> <span class="nc">SomeClass</span><span class="p">:</span>
<a id="__codelineno-45-2" name="__codelineno-45-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-45-3" name="__codelineno-45-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">open_resource</span><span class="p">()</span>
<a id="__codelineno-45-4" name="__codelineno-45-4"></a>
<a id="__codelineno-45-5" name="__codelineno-45-5"></a>    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-45-6" name="__codelineno-45-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-45-7" name="__codelineno-45-7"></a>
<a id="__codelineno-45-8" name="__codelineno-45-8"></a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-45-9" name="__codelineno-45-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-45-10" name="__codelineno-45-10"></a>
<a id="__codelineno-45-11" name="__codelineno-45-11"></a>    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-45-12" name="__codelineno-45-12"></a>        <span class="k">return</span> <span class="bp">self</span>
<a id="__codelineno-45-13" name="__codelineno-45-13"></a>
<a id="__codelineno-45-14" name="__codelineno-45-14"></a>    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ty</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">tb</span><span class="p">):</span>
<a id="__codelineno-45-15" name="__codelineno-45-15"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-45-16" name="__codelineno-45-16"></a>
<a id="__codelineno-45-17" name="__codelineno-45-17"></a><span class="c1"># Closed via __del__()</span>
<a id="__codelineno-45-18" name="__codelineno-45-18"></a><span class="n">s</span> <span class="o">=</span> <span class="n">SomeClass</span><span class="p">()</span>
<a id="__codelineno-45-19" name="__codelineno-45-19"></a><span class="k">del</span> <span class="n">s</span>
<a id="__codelineno-45-20" name="__codelineno-45-20"></a>
<a id="__codelineno-45-21" name="__codelineno-45-21"></a><span class="c1"># Explicit close</span>
<a id="__codelineno-45-22" name="__codelineno-45-22"></a><span class="n">s</span> <span class="o">=</span> <span class="n">SomeClass</span><span class="p">()</span>
<a id="__codelineno-45-23" name="__codelineno-45-23"></a><span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-45-24" name="__codelineno-45-24"></a>
<a id="__codelineno-45-25" name="__codelineno-45-25"></a><span class="c1"># Closed at the end of a context block</span>
<a id="__codelineno-45-26" name="__codelineno-45-26"></a><span class="k">with</span> <span class="n">SomeClass</span><span class="p">()</span> <span class="k">as</span> <span class="n">s</span><span class="p">:</span>
<a id="__codelineno-45-27" name="__codelineno-45-27"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
<p>Again, it should be emphasized that writing a <code>del()</code> in a class is almost never necessary. Python already has garbage collection and there is simply no need to do it unless there is some extra action that needs to take place upon object destruction. Even then, you still might not need <code>del()</code> as it’s possible that the object is already programmed to clean itself up properly even if you do nothing.</p>
<p>As if there weren’t enough dangers with reference counting and object destruction, there are certain kinds of programming patterns—especially those involving parent-child relationships, graphs, or caching—where objects can create a so-called reference cycle.
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-46-1">1</a></span>
<span class="normal"><a href="#__codelineno-46-2">2</a></span>
<span class="normal"><a href="#__codelineno-46-3">3</a></span>
<span class="normal"><a href="#__codelineno-46-4">4</a></span>
<span class="normal"><a href="#__codelineno-46-5">5</a></span>
<span class="normal"><a href="#__codelineno-46-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1"></a><span class="k">class</span> <span class="nc">SomeClass</span><span class="p">:</span>
<a id="__codelineno-46-2" name="__codelineno-46-2"></a>    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-46-3" name="__codelineno-46-3"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Deleting&#39;</span><span class="p">)</span>
<a id="__codelineno-46-4" name="__codelineno-46-4"></a>
<a id="__codelineno-46-5" name="__codelineno-46-5"></a><span class="n">parent</span> <span class="o">=</span> <span class="n">SomeClass</span><span class="p">()</span>
<a id="__codelineno-46-6" name="__codelineno-46-6"></a><span class="n">child</span> <span class="o">=</span> <span class="n">SomeClass</span><span class="p">()</span>
</code></pre></div></td></tr></table></div></p>
<h1 id="create-a-child-parent-reference-cycle">Create a child-parent reference cycle</h1>
<p>parent.child = child
child.parent = parent</p>
<h1 id="try-deletion-no-output-from-del-appears">Try deletion (no output from <strong>del</strong> appears)</h1>
<p>del parent
del child</p>
<p>In this example, the variable names are destroyed but you never see execution of the <code>del()</code> method. The two objects each hold internal references to each other, so there’s no way for the reference count to ever drop to 0. To handle this, a special cycle-detecting garbage collector runs every so often. Eventually the objects will be reclaimed, but it’s hard to predict when this might happen. If you want to force garbage collection, you can call <code>gc.collect()</code>. The <code>gc</code> module has a variety of other functions related to the cyclic garbage collector and monitoring memory.</p>
<p>Because of the unpredictable timing of garbage collection, the <code>del()</code> method has a few restrictions placed on it. First, any exception that propagates out of <code>del()</code> is printed to <code>sys.stderr</code>, but otherwise ignored. Second, the <code>del()</code> method should avoid operations such as acquiring locks or other resources. Doing so could result in a deadlock when <code>del()</code> is unexpectedly fired in the middle of executing an unrelated function within the seventh inner callback circle of signal handling and threads. If you must define <code>del()</code>, keep it simple.</p>
<p><strong>weak references</strong></p>
<p>Sometimes objects are kept alive when you’d much rather see them die. In an earlier example, a <code>Date</code> class was shown with internal caching of instances. One problem with this implementation is that there is no way for an instance to ever be removed from the cache. As such, the cache will grow larger and larger over time.</p>
<p>One way to fix this problem is to create a weak reference using the <code>weakref</code> module. A weak reference is a way of creating a reference to an object without increasing its reference count. To work with a weak reference, you have to add an extra bit of code to check if the object being referred to still exists. Here’s an example of how you create a weakref:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-47-1">1</a></span>
<span class="normal"><a href="#__codelineno-47-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1"></a><span class="kn">import</span> <span class="nn">weakref</span>
<a id="__codelineno-47-2" name="__codelineno-47-2"></a><span class="n">a_ref</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>In this example, <code>a_ref</code> is a weak reference to the object <code>a</code>. You can use the weak reference to access the object, but it doesn't prevent the object from being garbage collected.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-48-1">1</a></span>
<span class="normal"><a href="#__codelineno-48-2">2</a></span>
<span class="normal"><a href="#__codelineno-48-3">3</a></span>
<span class="normal"><a href="#__codelineno-48-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1"></a><span class="n">a</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="s1">&#39;Guido&#39;</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">)</span>
<a id="__codelineno-48-2" name="__codelineno-48-2"></a><span class="kn">import</span> <span class="nn">weakref</span>
<a id="__codelineno-48-3" name="__codelineno-48-3"></a><span class="n">a_ref</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<a id="__codelineno-48-4" name="__codelineno-48-4"></a><span class="n">a_ref</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<p>Support for weak references requires instances to have a mutable <code>weakref</code> attribute. Instances of user-defined classes normally have such an attribute by default. However, built-in types and certain kinds of special data structures—named tuples, classes with slots—do not. If you want to construct weak references to these types, you can do it by defining variants with a <code>weakref</code> attribute added:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-49-1">1</a></span>
<span class="normal"><a href="#__codelineno-49-2">2</a></span>
<span class="normal"><a href="#__codelineno-49-3">3</a></span>
<span class="normal"><a href="#__codelineno-49-4">4</a></span>
<span class="normal"><a href="#__codelineno-49-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1"></a><span class="k">class</span> <span class="nc">wdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-49-2" name="__codelineno-49-2"></a>    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;__weakref__&#39;</span><span class="p">,)</span>
<a id="__codelineno-49-3" name="__codelineno-49-3"></a>
<a id="__codelineno-49-4" name="__codelineno-49-4"></a><span class="n">w</span> <span class="o">=</span> <span class="n">wdict</span><span class="p">()</span>
<a id="__codelineno-49-5" name="__codelineno-49-5"></a><span class="n">w_ref</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>      <span class="c1"># Now works</span>
</code></pre></div></td></tr></table></div>
<p><strong>attribute binding</strong></p>
<p>The state associated with an instance is stored in a dictionary that’s accessible as the instance’s <code>__dict__</code> attribute. This dictionary contains the data that’s unique to each instance.</p>
<p>Classes are linked to their base classes by a special attribute <code>__bases__</code>, which is a tuple of the base classes. The <code>__bases__</code> attribute is only informational. The actual runtime implementation of inheritance uses the <code>__mro__</code> attribute which is a tuple of all parent classes listed in search order. This underlying structure is the basis for all operations that get, set, or delete the attributes of instances.</p>
<p>Whenever an attribute is set using <code>obj.name = value</code>, the special method <code>obj.__setattr__('name', value)</code> is invoked. If an attribute is deleted using <code>del obj.name</code>, the special method <code>obj.__delattr__('name')</code> is invoked. The default behavior of these methods is to modify or remove values from the local <code>__dict__</code> of <code>obj</code> unless the requested attribute happens to correspond to a property or descriptor. In that case, the set and delete operations will be carried out by the <code>__set__</code> and <code>__delete__</code> functions associated with the property.</p>
<p>For attribute lookup such as <code>obj.name</code>, the special method <code>obj.__getattribute__('name')</code> is invoked. This method carries out the search for the attribute, which normally includes checking the properties, looking in the local <code>__dict__</code>, checking the class dictionary, and searching the MRO. If this search fails, a final attempt to find the attribute is made by invoking the <code>obj.__getattr__('name')</code> method of the class (if defined). If this fails, an <code>AttributeError</code> exception is raised.</p>
<p>User-defined classes can implement their own versions of the attribute access functions, if desired. For example, here’s a class that restricts the attribute names that can be set:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-50-1">1</a></span>
<span class="normal"><a href="#__codelineno-50-2">2</a></span>
<span class="normal"><a href="#__codelineno-50-3">3</a></span>
<span class="normal"><a href="#__codelineno-50-4">4</a></span>
<span class="normal"><a href="#__codelineno-50-5">5</a></span>
<span class="normal"><a href="#__codelineno-50-6">6</a></span>
<span class="normal"><a href="#__codelineno-50-7">7</a></span>
<span class="normal"><a href="#__codelineno-50-8">8</a></span>
<span class="normal"><a href="#__codelineno-50-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1"></a><span class="k">class</span> <span class="nc">Account</span><span class="p">:</span>
<a id="__codelineno-50-2" name="__codelineno-50-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">balance</span><span class="p">):</span>
<a id="__codelineno-50-3" name="__codelineno-50-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">owner</span>
<a id="__codelineno-50-4" name="__codelineno-50-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">=</span> <span class="n">balance</span>
<a id="__codelineno-50-5" name="__codelineno-50-5"></a>
<a id="__codelineno-50-6" name="__codelineno-50-6"></a>    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<a id="__codelineno-50-7" name="__codelineno-50-7"></a>        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;owner&#39;</span><span class="p">,</span> <span class="s1">&#39;balance&#39;</span><span class="p">}:</span>
<a id="__codelineno-50-8" name="__codelineno-50-8"></a>            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No attribute </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-50-9" name="__codelineno-50-9"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h1 id="example">Example</h1>
<p>a = Account('Guido', 1000.0)
a.balance = 940.25          # Ok
a.amount = 540.2            # AttributeError. No attribute amount</p>
<p><strong>proxies, wrappers, delegations</strong></p>
<p>A common implementation technique for proxies involves the <code>getattr()</code> method. Here is a simple example:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-51-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-51-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-51-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-51-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-51-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-51-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-51-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-51-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-51-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-51-10">10</a></span>
<span class="normal"><a href="#__codelineno-51-11">11</a></span>
<span class="normal"><a href="#__codelineno-51-12">12</a></span>
<span class="normal"><a href="#__codelineno-51-13">13</a></span>
<span class="normal"><a href="#__codelineno-51-14">14</a></span>
<span class="normal"><a href="#__codelineno-51-15">15</a></span>
<span class="normal"><a href="#__codelineno-51-16">16</a></span>
<span class="normal"><a href="#__codelineno-51-17">17</a></span>
<span class="normal"><a href="#__codelineno-51-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1"></a><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
<a id="__codelineno-51-2" name="__codelineno-51-2"></a>    <span class="k">def</span> <span class="nf">spam</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-51-3" name="__codelineno-51-3"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;A.spam&#39;</span><span class="p">)</span>
<a id="__codelineno-51-4" name="__codelineno-51-4"></a>
<a id="__codelineno-51-5" name="__codelineno-51-5"></a>    <span class="k">def</span> <span class="nf">grok</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-51-6" name="__codelineno-51-6"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;A.grok&#39;</span><span class="p">)</span>
<a id="__codelineno-51-7" name="__codelineno-51-7"></a>
<a id="__codelineno-51-8" name="__codelineno-51-8"></a>    <span class="k">def</span> <span class="nf">yow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-51-9" name="__codelineno-51-9"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;A.yow&#39;</span><span class="p">)</span>
<a id="__codelineno-51-10" name="__codelineno-51-10"></a>
<a id="__codelineno-51-11" name="__codelineno-51-11"></a><span class="k">class</span> <span class="nc">LoggedA</span><span class="p">:</span>
<a id="__codelineno-51-12" name="__codelineno-51-12"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-51-13" name="__codelineno-51-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
<a id="__codelineno-51-14" name="__codelineno-51-14"></a>
<a id="__codelineno-51-15" name="__codelineno-51-15"></a>    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<a id="__codelineno-51-16" name="__codelineno-51-16"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Accessing&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<a id="__codelineno-51-17" name="__codelineno-51-17"></a>        <span class="c1"># Delegate to internal A instance</span>
<a id="__codelineno-51-18" name="__codelineno-51-18"></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_a</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>In this example, the <code>LoggedA</code> class acts as a proxy for class <code>A</code>. When an attribute is accessed on an instance of <code>LoggedA</code>, the <code>__getattr__()</code> method is invoked. It prints the accessed attribute name and then delegates the attribute access to the internal instance of <code>A</code>.</p>
<p><strong>Example use:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-52-1">1</a></span>
<span class="normal"><a href="#__codelineno-52-2">2</a></span>
<span class="normal"><a href="#__codelineno-52-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1"></a><span class="n">a</span> <span class="o">=</span> <span class="n">LoggedA</span><span class="p">()</span>
<a id="__codelineno-52-2" name="__codelineno-52-2"></a><span class="n">a</span><span class="o">.</span><span class="n">spam</span><span class="p">()</span>       <span class="c1"># prints &#39;Accessing spam&#39; and &#39;A.spam&#39;</span>
<a id="__codelineno-52-3" name="__codelineno-52-3"></a><span class="n">a</span><span class="o">.</span><span class="n">yow</span><span class="p">()</span>        <span class="c1"># prints &#39;Accessing yow&#39; and &#39;A.yow&#39;</span>
</code></pre></div></td></tr></table></div>
<p>Delegation is sometimes used as an alternative to inheritance. Here is an example:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-53-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-53-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-53-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-53-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-53-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-53-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-53-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-53-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-53-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-53-10">10</a></span>
<span class="normal"><a href="#__codelineno-53-11">11</a></span>
<span class="normal"><a href="#__codelineno-53-12">12</a></span>
<span class="normal"><a href="#__codelineno-53-13">13</a></span>
<span class="normal"><a href="#__codelineno-53-14">14</a></span>
<span class="normal"><a href="#__codelineno-53-15">15</a></span>
<span class="normal"><a href="#__codelineno-53-16">16</a></span>
<span class="normal"><a href="#__codelineno-53-17">17</a></span>
<span class="normal"><a href="#__codelineno-53-18">18</a></span>
<span class="normal"><a href="#__codelineno-53-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1"></a><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
<a id="__codelineno-53-2" name="__codelineno-53-2"></a>    <span class="k">def</span> <span class="nf">spam</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-53-3" name="__codelineno-53-3"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;A.spam&#39;</span><span class="p">)</span>
<a id="__codelineno-53-4" name="__codelineno-53-4"></a>
<a id="__codelineno-53-5" name="__codelineno-53-5"></a>    <span class="k">def</span> <span class="nf">grok</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-53-6" name="__codelineno-53-6"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;A.grok&#39;</span><span class="p">)</span>
<a id="__codelineno-53-7" name="__codelineno-53-7"></a>
<a id="__codelineno-53-8" name="__codelineno-53-8"></a>    <span class="k">def</span> <span class="nf">yow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-53-9" name="__codelineno-53-9"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;A.yow&#39;</span><span class="p">)</span>
<a id="__codelineno-53-10" name="__codelineno-53-10"></a>
<a id="__codelineno-53-11" name="__codelineno-53-11"></a><span class="k">class</span> <span class="nc">B</span><span class="p">:</span>
<a id="__codelineno-53-12" name="__codelineno-53-12"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-53-13" name="__codelineno-53-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
<a id="__codelineno-53-14" name="__codelineno-53-14"></a>
<a id="__codelineno-53-15" name="__codelineno-53-15"></a>    <span class="k">def</span> <span class="nf">grok</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-53-16" name="__codelineno-53-16"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;B.grok&#39;</span><span class="p">)</span>
<a id="__codelineno-53-17" name="__codelineno-53-17"></a>
<a id="__codelineno-53-18" name="__codelineno-53-18"></a>    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<a id="__codelineno-53-19" name="__codelineno-53-19"></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_a</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>In this example, class <code>B</code> holds an internal reference to an instance of <code>A</code> and delegates attribute access to it. Methods defined in class <code>B</code> override the corresponding methods in class <code>A</code>, while all other methods are delegated to the internal instance of <code>A</code>.</p>
<p><strong>Example use:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-54-1">1</a></span>
<span class="normal"><a href="#__codelineno-54-2">2</a></span>
<span class="normal"><a href="#__codelineno-54-3">3</a></span>
<span class="normal"><a href="#__codelineno-54-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1"></a><span class="n">b</span> <span class="o">=</span> <span class="n">B</span><span class="p">()</span>
<a id="__codelineno-54-2" name="__codelineno-54-2"></a><span class="n">b</span><span class="o">.</span><span class="n">spam</span><span class="p">()</span>      <span class="c1"># -&gt; A.spam</span>
<a id="__codelineno-54-3" name="__codelineno-54-3"></a><span class="n">b</span><span class="o">.</span><span class="n">grok</span><span class="p">()</span>      <span class="c1"># -&gt; B.grok   (redefined method)</span>
<a id="__codelineno-54-4" name="__codelineno-54-4"></a><span class="n">b</span><span class="o">.</span><span class="n">yow</span><span class="p">()</span>       <span class="c1"># -&gt; A.yow</span>
</code></pre></div></td></tr></table></div>
<p>The technique of forwarding attribute lookup via <code>__getattr__()</code> is a common technique. However, be aware that it does not apply to operations mapped to special methods. For example, consider this class:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-55-1">1</a></span>
<span class="normal"><a href="#__codelineno-55-2">2</a></span>
<span class="normal"><a href="#__codelineno-55-3">3</a></span>
<span class="normal"><a href="#__codelineno-55-4">4</a></span>
<span class="normal"><a href="#__codelineno-55-5">5</a></span>
<span class="normal"><a href="#__codelineno-55-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1"></a><span class="k">class</span> <span class="nc">ListLike</span><span class="p">:</span>
<a id="__codelineno-55-2" name="__codelineno-55-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-55-3" name="__codelineno-55-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<a id="__codelineno-55-4" name="__codelineno-55-4"></a>
<a id="__codelineno-55-5" name="__codelineno-55-5"></a>    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<a id="__codelineno-55-6" name="__codelineno-55-6"></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>In this example, the <code>ListLike</code> class forwards all of the standard list methods to an inner list using <code>__getattr__()</code>. However, operations such as <code>len(a)</code> or <code>a[0]</code> fail because they are not mapped to special methods (<code>__len__()</code> and <code>__getitem__()</code>). To make those work, you would have to explicitly implement the required special methods.</p>
<p>To illustrate, here's an updated <code>ListLike</code> class that implements the necessary special methods:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-56-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-56-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-56-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-56-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-56-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-56-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-56-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-56-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-56-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-56-10">10</a></span>
<span class="normal"><a href="#__codelineno-56-11">11</a></span>
<span class="normal"><a href="#__codelineno-56-12">12</a></span>
<span class="normal"><a href="#__codelineno-56-13">13</a></span>
<span class="normal"><a href="#__codelineno-56-14">14</a></span>
<span class="normal"><a href="#__codelineno-56-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1"></a><span class="k">class</span> <span class="nc">ListLike</span><span class="p">:</span>
<a id="__codelineno-56-2" name="__codelineno-56-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-56-3" name="__codelineno-56-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<a id="__codelineno-56-4" name="__codelineno-56-4"></a>
<a id="__codelineno-56-5" name="__codelineno-56-5"></a>    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<a id="__codelineno-56-6" name="__codelineno-56-6"></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<a id="__codelineno-56-7" name="__codelineno-56-7"></a>
<a id="__codelineno-56-8" name="__codelineno-56-8"></a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-56-9" name="__codelineno-56-9"></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="p">)</span>
<a id="__codelineno-56-10" name="__codelineno-56-10"></a>
<a id="__codelineno-56-11" name="__codelineno-56-11"></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<a id="__codelineno-56-12" name="__codelineno-56-12"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
<a id="__codelineno-56-13" name="__codelineno-56-13"></a>
<a id="__codelineno-56-14" name="__codelineno-56-14"></a>    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<a id="__codelineno-56-15" name="__codelineno-56-15"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
<h1 id="slots">slots</h1>
<p>The <code>slots</code> attribute is a definition hint that allows Python to make performance optimizations for both memory use and execution speed. It eliminates the need for a dictionary to store instance data and uses a more compact array-based data structure instead. Using <code>slots</code> can result in a substantial reduction in memory use and a modest improvement in execution time, especially in programs that create a large number of objects.</p>
<p>Here are some key points about <code>slots</code>:</p>
<ul>
<li>The <code>slots</code> attribute lists only the instance attributes and does not include methods, properties, class variables, or any other class-level attributes.</li>
<li>If a class uses <code>slots</code>, any derived class must also define <code>slots</code> (even if empty) to take advantage of the benefits. Failure to do so will result in slower performance and increased memory usage.</li>
<li><code>slots</code> is not compatible with multiple inheritance. If multiple base classes with non-empty <code>slots</code> are specified, a <code>TypeError</code> will be raised.</li>
<li>Code that relies on the underlying <code>__dict__</code> attribute of instances may break when <code>slots</code> is used.</li>
<li><code>slots</code> has no effect on the invocation of methods such as <code>__getattribute__()</code>, <code>__getattr__()</code>, and <code>__setattr__()</code> if they are redefined in a class. However, the absence of the instance <code>__dict__</code> attribute should be considered when implementing these methods.</li>
</ul>
<h1 id="descriptors">Descriptors</h1>
<p>Descriptors provide a way to customize attribute access in Python by implementing the special methods <code>__get__()</code>, <code>__set__()</code>, and <code>__delete__()</code>. They are class-level objects that manage access to attributes. Properties are implemented using descriptors.</p>
<p>Here's an example of a descriptor class called <code>Typed</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-57-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-57-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-57-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-57-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-57-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-57-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-57-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-57-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-57-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-57-10">10</a></span>
<span class="normal"><a href="#__codelineno-57-11">11</a></span>
<span class="normal"><a href="#__codelineno-57-12">12</a></span>
<span class="normal"><a href="#__codelineno-57-13">13</a></span>
<span class="normal"><a href="#__codelineno-57-14">14</a></span>
<span class="normal"><a href="#__codelineno-57-15">15</a></span>
<span class="normal"><a href="#__codelineno-57-16">16</a></span>
<span class="normal"><a href="#__codelineno-57-17">17</a></span>
<span class="normal"><a href="#__codelineno-57-18">18</a></span>
<span class="normal"><a href="#__codelineno-57-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1"></a><span class="k">class</span> <span class="nc">Typed</span><span class="p">:</span>
<a id="__codelineno-57-2" name="__codelineno-57-2"></a>    <span class="n">expected_type</span> <span class="o">=</span> <span class="nb">object</span>
<a id="__codelineno-57-3" name="__codelineno-57-3"></a>
<a id="__codelineno-57-4" name="__codelineno-57-4"></a>    <span class="k">def</span> <span class="nf">__set_name__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<a id="__codelineno-57-5" name="__codelineno-57-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">name</span>
<a id="__codelineno-57-6" name="__codelineno-57-6"></a>
<a id="__codelineno-57-7" name="__codelineno-57-7"></a>    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
<a id="__codelineno-57-8" name="__codelineno-57-8"></a>        <span class="k">if</span> <span class="n">instance</span><span class="p">:</span>
<a id="__codelineno-57-9" name="__codelineno-57-9"></a>            <span class="k">return</span> <span class="n">instance</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span>
<a id="__codelineno-57-10" name="__codelineno-57-10"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-57-11" name="__codelineno-57-11"></a>            <span class="k">return</span> <span class="bp">self</span>
<a id="__codelineno-57-12" name="__codelineno-57-12"></a>
<a id="__codelineno-57-13" name="__codelineno-57-13"></a>    <span class="k">def</span> <span class="fm">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<a id="__codelineno-57-14" name="__codelineno-57-14"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expected_type</span><span class="p">):</span>
<a id="__codelineno-57-15" name="__codelineno-57-15"></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Expected </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">expected_type</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-57-16" name="__codelineno-57-16"></a>        <span class="n">instance</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
<a id="__codelineno-57-17" name="__codelineno-57-17"></a>
<a id="__codelineno-57-18" name="__codelineno-57-18"></a>    <span class="k">def</span> <span class="fm">__delete__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
<a id="__codelineno-57-19" name="__codelineno-57-19"></a>        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t delete attribute&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>In this example, the <code>Typed</code> class defines a descriptor that performs type checking when an attribute is assigned and raises an error if an attempt is made to delete the attribute. Subclasses like <code>Integer</code>, <code>Float</code>, and <code>String</code> specialize <code>Typed</code> to match specific types.</p>
<p>Descriptors are used by including them as class attributes in another class. For example:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-58-1">1</a></span>
<span class="normal"><a href="#__codelineno-58-2">2</a></span>
<span class="normal"><a href="#__codelineno-58-3">3</a></span>
<span class="normal"><a href="#__codelineno-58-4">4</a></span>
<span class="normal"><a href="#__codelineno-58-5">5</a></span>
<span class="normal"><a href="#__codelineno-58-6">6</a></span>
<span class="normal"><a href="#__codelineno-58-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1"></a><span class="k">class</span> <span class="nc">Account</span><span class="p">:</span>
<a id="__codelineno-58-2" name="__codelineno-58-2"></a>    <span class="n">owner</span> <span class="o">=</span> <span class="n">String</span><span class="p">()</span>
<a id="__codelineno-58-3" name="__codelineno-58-3"></a>    <span class="n">balance</span> <span class="o">=</span> <span class="n">Float</span><span class="p">()</span>
<a id="__codelineno-58-4" name="__codelineno-58-4"></a>
<a id="__codelineno-58-5" name="__codelineno-58-5"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">balance</span><span class="p">):</span>
<a id="__codelineno-58-6" name="__codelineno-58-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">owner</span>
<a id="__codelineno-58-7" name="__codelineno-58-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">=</span> <span class="n">balance</span>
</code></pre></div></td></tr></table></div>
<p>In this case, the <code>Account</code> class uses the descriptors <code>String</code> and <code>Float</code> to automatically call the appropriate <code>__get__()</code>, <code>__set__()</code>, or <code>__delete__()</code> methods when accessing the <code>owner</code> and <code>balance</code> attributes.</p>
<p>Descriptors take precedence over items in the instance dictionary. Even if an instance dictionary has a matching entry, the descriptor's <code>__set__()</code> method will be invoked. For example:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-59-1">1</a></span>
<span class="normal"><a href="#__codelineno-59-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1"></a><span class="n">a</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="s1">&#39;Guido&#39;</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">)</span>
<a id="__codelineno-59-2" name="__codelineno-59-2"></a><span class="n">a</span><span class="o">.</span><span class="n">balance</span> <span class="o">=</span> <span class="s1">&#39;a lot&#39;</span>  <span class="c1"># Raises TypeError: Expected &lt;class &#39;float&#39;&gt;</span>
</code></pre></div></td></tr></table></div>
<p>The <code>__get__(instance, cls)</code> method of a descriptor takes arguments for both the instance and the class. When invoked at the class level, the instance argument is <code>None</code>. The <code>__get__()</code> method typically returns the descriptor itself if no instance is provided.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-60-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1"></a><span class="n">Account</span><span class="o">.</span><span class="n">balance</span>  <span class="c1"># Returns &lt;__main__.Float object at 0x110606710&gt;</span>
</code></pre></div></td></tr></table></div>
<h2 id="method-descriptor">Method Descriptor</h2>
<p>A descriptor that only implements <code>__get__()</code> is known as a method descriptor. It is mainly used to implement Python's various types of methods, such as instance methods, class methods, and static methods. The <code>__get__()</code> method of a method descriptor only gets invoked if there is no matching entry in the instance dictionary.</p>
<p>Here's an example of implementing <code>@classmethod</code> and <code>@staticmethod</code> using method descriptors:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-61-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-61-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-61-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-61-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-61-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-61-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-61-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-61-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-61-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-61-10">10</a></span>
<span class="normal"><a href="#__codelineno-61-11">11</a></span>
<span class="normal"><a href="#__codelineno-61-12">12</a></span>
<span class="normal"><a href="#__codelineno-61-13">13</a></span>
<span class="normal"><a href="#__codelineno-61-14">14</a></span>
<span class="normal"><a href="#__codelineno-61-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1"></a><span class="kn">import</span> <span class="nn">types</span>
<a id="__codelineno-61-2" name="__codelineno-61-2"></a>
<a id="__codelineno-61-3" name="__codelineno-61-3"></a><span class="k">class</span> <span class="nc">classmethod</span><span class="p">:</span>
<a id="__codelineno-61-4" name="__codelineno-61-4"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
<a id="__codelineno-61-5" name="__codelineno-61-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="vm">__func__</span> <span class="o">=</span> <span class="n">func</span>
<a id="__codelineno-61-6" name="__codelineno-61-6"></a>
<a id="__codelineno-61-7" name="__codelineno-61-7"></a>    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
<a id="__codelineno-61-8" name="__codelineno-61-8"></a>        <span class="k">return</span> <span class="n">types</span><span class="o">.</span><span class="n">MethodType</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__func__</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span>
<a id="__codelineno-61-9" name="__codelineno-61-9"></a>
<a id="__codelineno-61-10" name="__codelineno-61-10"></a><span class="k">class</span> <span class="nc">staticmethod</span><span class="p">:</span>
<a id="__codelineno-61-11" name="__codelineno-61-11"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
<a id="__codelineno-61-12" name="__codelineno-61-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="vm">__func__</span> <span class="o">=</span> <span class="n">func</span>
<a id="__codelineno-61-13" name="__codelineno-61-13"></a>
<a id="__codelineno-61-14" name="__codelineno-61-14"></a>    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
<a id="__codelineno-61-15" name="__codelineno-61-15"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__func__</span>
</code></pre></div></td></tr></table></div>
<p>Lazy Evaluation</p>
<p>Method descriptors can be used to implement lazy evaluation of attributes. By only computing and assigning the attribute value when it is accessed for the first time, we can save computational resources.</p>
<p>Here's an example of implementing lazy evaluation using a descriptor called <code>Lazy</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-62-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-62-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-62-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-62-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-62-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-62-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-62-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-62-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-62-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-62-10">10</a></span>
<span class="normal"><a href="#__codelineno-62-11">11</a></span>
<span class="normal"><a href="#__codelineno-62-12">12</a></span>
<span class="normal"><a href="#__codelineno-62-13">13</a></span>
<span class="normal"><a href="#__codelineno-62-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1"></a><span class="k">class</span> <span class="nc">Lazy</span><span class="p">:</span>
<a id="__codelineno-62-2" name="__codelineno-62-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
<a id="__codelineno-62-3" name="__codelineno-62-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">func</span>
<a id="__codelineno-62-4" name="__codelineno-62-4"></a>
<a id="__codelineno-62-5" name="__codelineno-62-5"></a>    <span class="k">def</span> <span class="nf">__set_name__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<a id="__codelineno-62-6" name="__codelineno-62-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">name</span>
<a id="__codelineno-62-7" name="__codelineno-62-7"></a>
<a id="__codelineno-62-8" name="__codelineno-62-8"></a>    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
<a id="__codelineno-62-9" name="__codelineno-62-9"></a>        <span class="k">if</span> <span class="n">instance</span><span class="p">:</span>
<a id="__codelineno-62-10" name="__codelineno-62-10"></a>            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
<a id="__codelineno-62-11" name="__codelineno-62-11"></a>            <span class="n">instance</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
<a id="__codelineno-62-12" name="__codelineno-62-12"></a>            <span class="k">return</span> <span class="n">value</span>
<a id="__codelineno-62-13" name="__codelineno-62-13"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-62-14" name="__codelineno-62-14"></a>            <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
<p>In this example, the <code>Lazy</code> descriptor is used in the <code>Rectangle</code> class to lazily compute the area and perimeter attributes:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-63-1">1</a></span>
<span class="normal"><a href="#__codelineno-63-2">2</a></span>
<span class="normal"><a href="#__codelineno-63-3">3</a></span>
<span class="normal"><a href="#__codelineno-63-4">4</a></span>
<span class="normal"><a href="#__codelineno-63-5">5</a></span>
<span class="normal"><a href="#__codelineno-63-6">6</a></span>
<span class="normal"><a href="#__codelineno-63-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1"></a><span class="k">class</span> <span class="nc">Rectangle</span><span class="p">:</span>
<a id="__codelineno-63-2" name="__codelineno-63-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">):</span>
<a id="__codelineno-63-3" name="__codelineno-63-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
<a id="__codelineno-63-4" name="__codelineno-63-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">height</span>
<a id="__codelineno-63-5" name="__codelineno-63-5"></a>
<a id="__codelineno-63-6" name="__codelineno-63-6"></a>    <span class="n">area</span> <span class="o">=</span> <span class="n">Lazy</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
<a id="__codelineno-63-7" name="__codelineno-63-7"></a>    <span class="n">perimeter</span> <span class="o">=</span> <span class="n">Lazy</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>When the <code>area</code> or <code>perimeter</code> attributes are accessed for the first time, the corresponding lambda function is executed to compute the value. The computed value is then stored in the instance's <code>__dict__</code> attribute for future use.</p>
<h2 id="class-definitions">Class Definitions</h2>
<p>The definition of a class is a dynamic process. When you define a class using the class statement, a new dictionary is created that serves as the local class namespace. The body of the class then executes as a script within this namespace. Eventually, the namespace becomes the <code>__dict__</code> attribute of the resulting class object.</p>
<p>Any legal Python statement is allowed in the body of a class. Normally, you just define functions and variables, but control flow, imports, nested classes, and everything else is allowed. For example, here is a class that conditionally defines methods:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-64-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-64-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-64-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-64-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-64-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-64-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-64-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-64-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-64-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-64-10">10</a></span>
<span class="normal"><a href="#__codelineno-64-11">11</a></span>
<span class="normal"><a href="#__codelineno-64-12">12</a></span>
<span class="normal"><a href="#__codelineno-64-13">13</a></span>
<span class="normal"><a href="#__codelineno-64-14">14</a></span>
<span class="normal"><a href="#__codelineno-64-15">15</a></span>
<span class="normal"><a href="#__codelineno-64-16">16</a></span>
<span class="normal"><a href="#__codelineno-64-17">17</a></span>
<span class="normal"><a href="#__codelineno-64-18">18</a></span>
<span class="normal"><a href="#__codelineno-64-19">19</a></span>
<span class="normal"><a href="#__codelineno-64-20">20</a></span>
<span class="normal"><a href="#__codelineno-64-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1"></a><span class="k">class</span> <span class="nc">Account</span><span class="p">:</span>
<a id="__codelineno-64-2" name="__codelineno-64-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">balance</span><span class="p">):</span>
<a id="__codelineno-64-3" name="__codelineno-64-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">owner</span>
<a id="__codelineno-64-4" name="__codelineno-64-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">=</span> <span class="n">balance</span>
<a id="__codelineno-64-5" name="__codelineno-64-5"></a>
<a id="__codelineno-64-6" name="__codelineno-64-6"></a>    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
<a id="__codelineno-64-7" name="__codelineno-64-7"></a>        <span class="kn">import</span> <span class="nn">logging</span>
<a id="__codelineno-64-8" name="__codelineno-64-8"></a>        <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="vm">__module__</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="vm">__qualname__</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-64-9" name="__codelineno-64-9"></a>        <span class="k">def</span> <span class="nf">deposit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
<a id="__codelineno-64-10" name="__codelineno-64-10"></a>            <span class="n">Account</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Depositing </span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>
<a id="__codelineno-64-11" name="__codelineno-64-11"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">+=</span> <span class="n">amount</span>
<a id="__codelineno-64-12" name="__codelineno-64-12"></a>
<a id="__codelineno-64-13" name="__codelineno-64-13"></a>        <span class="k">def</span> <span class="nf">withdraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
<a id="__codelineno-64-14" name="__codelineno-64-14"></a>            <span class="n">Account</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Withdrawing </span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>
<a id="__codelineno-64-15" name="__codelineno-64-15"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">-=</span> <span class="n">amount</span>
<a id="__codelineno-64-16" name="__codelineno-64-16"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-64-17" name="__codelineno-64-17"></a>        <span class="k">def</span> <span class="nf">deposit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
<a id="__codelineno-64-18" name="__codelineno-64-18"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">+=</span> <span class="n">amount</span>
<a id="__codelineno-64-19" name="__codelineno-64-19"></a>
<a id="__codelineno-64-20" name="__codelineno-64-20"></a>        <span class="k">def</span> <span class="nf">withdraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
<a id="__codelineno-64-21" name="__codelineno-64-21"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">-=</span> <span class="n">amount</span>
</code></pre></div></td></tr></table></div>
<p>In this example, a global variable <code>debug</code> is being used to conditionally define methods. The <code>__module__</code> and <code>__qualname__</code> variables are predefined strings that hold information about the class name and enclosing module. These can be used by statements in the class body. In this example, they're being used to configure the logging system. There are probably cleaner ways of organizing the above code, but the key point is that you can put anything you want in a class.</p>
<p>One critical point about class definition is that the namespace used to hold the contents of the class body is not a scope of variables. Any name that gets used within a method (such as <code>Account.log</code> in the above example) needs to be fully qualified.</p>
<p>If a function like <code>locals()</code> is used in a class body (but not inside a method), it returns the dictionary being used for the class namespace.</p>
<h2 id="dynamic-class-creation">Dynamic Class Creation</h2>
<p>Normally, classes are created using the <code>class</code> statement, but this is not a requirement. As noted in the previous section, classes are defined by executing the body of a class to populate a namespace. If you're able to populate a dictionary with your own definitions, you can make a class without ever using the <code>class</code> statement. To do that, use <code>types.new_class()</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-65-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-65-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-65-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-65-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-65-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-65-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-65-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-65-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-65-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-65-10">10</a></span>
<span class="normal"><a href="#__codelineno-65-11">11</a></span>
<span class="normal"><a href="#__codelineno-65-12">12</a></span>
<span class="normal"><a href="#__codelineno-65-13">13</a></span>
<span class="normal"><a href="#__codelineno-65-14">14</a></span>
<span class="normal"><a href="#__codelineno-65-15">15</a></span>
<span class="normal"><a href="#__codelineno-65-16">16</a></span>
<span class="normal"><a href="#__codelineno-65-17">17</a></span>
<span class="normal"><a href="#__codelineno-65-18">18</a></span>
<span class="normal"><a href="#__codelineno-65-19">19</a></span>
<span class="normal"><a href="#__codelineno-65-20">20</a></span>
<span class="normal"><a href="#__codelineno-65-21">21</a></span>
<span class="normal"><a href="#__codelineno-65-22">22</a></span>
<span class="normal"><a href="#__codelineno-65-23">23</a></span>
<span class="normal"><a href="#__codelineno-65-24">24</a></span>
<span class="normal"><a href="#__codelineno-65-25">25</a></span>
<span class="normal"><a href="#__codelineno-65-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1"></a><span class="kn">import</span> <span class="nn">types</span>
<a id="__codelineno-65-2" name="__codelineno-65-2"></a>
<a id="__codelineno-65-3" name="__codelineno-65-3"></a><span class="c1"># Some methods (not in a class)</span>
<a id="__codelineno-65-4" name="__codelineno-65-4"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">balance</span><span class="p">):</span>
<a id="__codelineno-65-5" name="__codelineno-65-5"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">owner</span>
<a id="__codelineno-65-6" name="__codelineno-65-6"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">=</span> <span class="n">balance</span>
<a id="__codelineno-65-7" name="__codelineno-65-7"></a>
<a id="__codelineno-65-8" name="__codelineno-65-8"></a><span class="k">def</span> <span class="nf">deposit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
<a id="__codelineno-65-9" name="__codelineno-65-9"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">-=</span> <span class="n">amount</span>
<a id="__codelineno-65-10" name="__codelineno-65-10"></a>
<a id="__codelineno-65-11" name="__codelineno-65-11"></a><span class="k">def</span> <span class="nf">withdraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
<a id="__codelineno-65-12" name="__codelineno-65-12"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">+=</span> <span class="n">amount</span>
<a id="__codelineno-65-13" name="__codelineno-65-13"></a>
<a id="__codelineno-65-14" name="__codelineno-65-14"></a><span class="n">methods</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-65-15" name="__codelineno-65-15"></a>   <span class="s1">&#39;__init__&#39;</span><span class="p">:</span> <span class="fm">__init__</span><span class="p">,</span>
<a id="__codelineno-65-16" name="__codelineno-65-16"></a>   <span class="s1">&#39;deposit&#39;</span><span class="p">:</span> <span class="n">deposit</span><span class="p">,</span>
<a id="__codelineno-65-17" name="__codelineno-65-17"></a>   <span class="s1">&#39;withdraw&#39;</span><span class="p">:</span> <span class="n">withdraw</span><span class="p">,</span>
<a id="__codelineno-65-18" name="__codelineno-65-18"></a><span class="p">}</span>
<a id="__codelineno-65-19" name="__codelineno-65-19"></a>
<a id="__codelineno-65-20" name="__codelineno-65-20"></a><span class="n">Account</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">new_class</span><span class="p">(</span><span class="s1">&#39;Account&#39;</span><span class="p">,</span> <span class="p">(),</span>
<a id="__codelineno-65-21" name="__codelineno-65-21"></a>               <span class="n">exec_body</span><span class="o">=</span><span class="k">lambda</span> <span class="n">ns</span><span class="p">:</span> <span class="n">ns</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">methods</span><span class="p">))</span>
<a id="__codelineno-65-22" name="__codelineno-65-22"></a>
<a id="__codelineno-65-23" name="__codelineno-65-23"></a><span class="c1"># You now have a class</span>
<a id="__codelineno-65-24" name="__codelineno-65-24"></a><span class="n">a</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="s1">&#39;Guido&#39;</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">)</span>
<a id="__codelineno-65-25" name="__codelineno-65-25"></a><span class="n">a</span><span class="o">.</span><span class="n">deposit</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<a id="__codelineno-65-26" name="__codelineno-65-26"></a><span class="n">a</span><span class="o">.</span><span class="n">withdraw</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>Dynamic class creation may be useful if you want to create classes from data structures or generate classes programmatically. For example, in the section on descriptors, the following classes were defined:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-66-1">1</a></span>
<span class="normal"><a href="#__codelineno-66-2">2</a></span>
<span class="normal"><a href="#__codelineno-66-3">3</a></span>
<span class="normal"><a href="#__codelineno-66-4">4</a></span>
<span class="normal"><a href="#__codelineno-66-5">5</a></span>
<span class="normal"><a href="#__codelineno-66-6">6</a></span>
<span class="normal"><a href="#__codelineno-66-7">7</a></span>
<span class="normal"><a href="#__codelineno-66-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1"></a><span class="k">class</span> <span class="nc">Integer</span><span class="p">(</span><span class="n">Typed</span><span class="p">):</span>
<a id="__codelineno-66-2" name="__codelineno-66-2"></a>    <span class="n">expected_type</span> <span class="o">=</span> <span class="nb">int</span>
<a id="__codelineno-66-3" name="__codelineno-66-3"></a>
<a id="__codelineno-66-4" name="__codelineno-66-4"></a><span class="k">class</span> <span class="nc">Float</span><span class="p">(</span><span class="n">Typed</span><span class="p">):</span>
<a id="__codelineno-66-5" name="__codelineno-66-5"></a>    <span class="n">expected_type</span> <span class="o">=</span> <span class="nb">float</span>
<a id="__codelineno-66-6" name="__codelineno-66-6"></a>
<a id="__codelineno-66-7" name="__codelineno-66-7"></a><span class="k">class</span> <span class="nc">String</span><span class="p">(</span><span class="n">Typed</span><span class="p">):</span>
<a id="__codelineno-66-8" name="__codelineno-66-8"></a>    <span class="n">expected_type</span> <span class="o">=</span> <span class="nb">str</span>
</code></pre></div></td></tr></table></div>
<p>This code is highly repetitive. A data-driven approach can be used to generate the classes dynamically:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-67-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-67-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-67-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-67-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-67-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-67-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-67-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-67-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-67-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-67-10">10</a></span>
<span class="normal"><a href="#__codelineno-67-11">11</a></span>
<span class="normal"><a href="#__codelineno-67-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1"></a><span class="n">typed_classes</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-67-2" name="__codelineno-67-2"></a>   <span class="p">(</span><span class="s1">&#39;Integer&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>
<a id="__codelineno-67-3" name="__codelineno-67-3"></a>   <span class="p">(</span><span class="s1">&#39;Float&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
<a id="__codelineno-67-4" name="__codelineno-67-4"></a>   <span class="p">(</span><span class="s1">&#39;String&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
<a id="__codelineno-67-5" name="__codelineno-67-5"></a>   <span class="p">(</span><span class="s1">&#39;Bool&#39;</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span>
<a id="__codelineno-67-6" name="__codelineno-67-6"></a>   <span class="p">(</span><span class="s1">&#39;Tuple&#39;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">),</span>
<a id="__codelineno-67-7" name="__codelineno-67-7"></a><span class="p">]</span>
<a id="__codelineno-67-8" name="__codelineno-67-8"></a>
<a id="__codelineno-67-9" name="__codelineno-67-9"></a><span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
<a id="__codelineno-67-10" name="__codelineno-67-10"></a>   <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">new_class</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="n">Typed</span><span class="p">,),</span>
<a id="__codelineno-67-11" name="__codelineno-67-11"></a>          <span class="n">exec_body</span><span class="o">=</span><span class="k">lambda</span> <span class="n">ns</span><span class="p">:</span> <span class="n">ns</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">expected_type</span><span class="o">=</span><span class="n">ty</span><span class="p">)))</span>
<a id="__codelineno-67-12" name="__codelineno-67-12"></a>   <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">ty</span> <span class="ow">in</span> <span class="n">typed_classes</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>In this example, the global module namespace is being updated with dynamically created classes using <code>types.new_class()</code>. The <code>typed_classes</code> list defines the names and expected types for each class. Each class is created by calling <code>types.new_class()</code> with the class name, base classes, and an <code>exec_body</code> function that updates the namespace with the expected type. The resulting classes are then added to the global namespace using <code>globals().update()</code>.</p>
<p>Sometimes you will see <code>type()</code> being used to dynamically create a class instead. For example:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-68-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1"></a><span class="n">Account</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="s1">&#39;Account&#39;</span><span class="p">,</span> <span class="p">(),</span> <span class="n">methods</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>This works, but it doesn’t take into account some of the more advanced class machinery such as metaclasses. In modern code, try to use <code>types.new_class()</code> instead.</p>
<h1 id="metaclasses">Metaclasses</h1>
<p>When you define a class in Python, the class definition itself becomes an object. Here's an example:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-69-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-69-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-69-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-69-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-69-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-69-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-69-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-69-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-69-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-69-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1"></a><span class="k">class</span> <span class="nc">Account</span><span class="p">:</span>
<a id="__codelineno-69-2" name="__codelineno-69-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">balance</span><span class="p">):</span>
<a id="__codelineno-69-3" name="__codelineno-69-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">owner</span>
<a id="__codelineno-69-4" name="__codelineno-69-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">=</span> <span class="n">balance</span>
<a id="__codelineno-69-5" name="__codelineno-69-5"></a>
<a id="__codelineno-69-6" name="__codelineno-69-6"></a>    <span class="k">def</span> <span class="nf">deposit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
<a id="__codelineno-69-7" name="__codelineno-69-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">+=</span> <span class="n">amount</span>
<a id="__codelineno-69-8" name="__codelineno-69-8"></a>
<a id="__codelineno-69-9" name="__codelineno-69-9"></a>    <span class="k">def</span> <span class="nf">withdraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
<a id="__codelineno-69-10" name="__codelineno-69-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">-=</span> <span class="n">amount</span>
</code></pre></div></td></tr></table></div>
<p>To check if <code>Account</code> is an object, you can use the <code>isinstance</code> function:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-70-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1"></a><span class="nb">isinstance</span><span class="p">(</span><span class="n">Account</span><span class="p">,</span> <span class="nb">object</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>If you think about this long enough, you will realize that if <code>Account</code> is an object, then something had to create it. This creation of the class object is controlled by a special kind of class called a metaclass. Simply put, a metaclass is a class that creates instances of classes.</p>
<p>In the preceding example, the metaclass that created <code>Account</code> is a built-in class called <code>type</code>. In fact, if you check the type of <code>Account</code>, you will see that it is an instance of <code>type</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-71-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1"></a><span class="nb">type</span><span class="p">(</span><span class="n">Account</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>It's a bit brain-bending, but it's similar to integers. For example, if you write <code>x = 42</code> and then look at <code>x.__class__</code>, you'll get <code>int</code>, which is the class that creates integers. Similarly, <code>type</code> makes instances of types or classes.</p>
<p>When a new class is defined with the <code>class</code> statement, a number of things happen. First, a new namespace for the class is created. Next, the body of the class is executed in this namespace. Finally, the class name, base classes, and populated namespace are used to create the class instance. The following code illustrates the low-level steps that take place:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-72-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-72-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-72-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-72-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-72-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-72-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-72-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-72-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-72-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-72-10">10</a></span>
<span class="normal"><a href="#__codelineno-72-11">11</a></span>
<span class="normal"><a href="#__codelineno-72-12">12</a></span>
<span class="normal"><a href="#__codelineno-72-13">13</a></span>
<span class="normal"><a href="#__codelineno-72-14">14</a></span>
<span class="normal"><a href="#__codelineno-72-15">15</a></span>
<span class="normal"><a href="#__codelineno-72-16">16</a></span>
<span class="normal"><a href="#__codelineno-72-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1"></a><span class="n">namespace</span> <span class="o">=</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__prepare__</span><span class="p">(</span><span class="s1">&#39;Account&#39;</span><span class="p">,</span> <span class="p">())</span>
<a id="__codelineno-72-2" name="__codelineno-72-2"></a>
<a id="__codelineno-72-3" name="__codelineno-72-3"></a><span class="c1"># Step 2: Execute the class body</span>
<a id="__codelineno-72-4" name="__codelineno-72-4"></a><span class="n">exec</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<a id="__codelineno-72-5" name="__codelineno-72-5"></a><span class="s1">def __init__(self, owner, balance):</span>
<a id="__codelineno-72-6" name="__codelineno-72-6"></a><span class="s1">    self.owner = owner</span>
<a id="__codelineno-72-7" name="__codelineno-72-7"></a><span class="s1">    self.balance = balance</span>
<a id="__codelineno-72-8" name="__codelineno-72-8"></a>
<a id="__codelineno-72-9" name="__codelineno-72-9"></a><span class="s1">def deposit(self, amount):</span>
<a id="__codelineno-72-10" name="__codelineno-72-10"></a><span class="s1">    self.balance += amount</span>
<a id="__codelineno-72-11" name="__codelineno-72-11"></a>
<a id="__codelineno-72-12" name="__codelineno-72-12"></a><span class="s1">def withdraw(self, amount):</span>
<a id="__codelineno-72-13" name="__codelineno-72-13"></a><span class="s1">    self.balance -= amount</span>
<a id="__codelineno-72-14" name="__codelineno-72-14"></a><span class="s1">&#39;&#39;&#39;</span><span class="p">,</span> <span class="nb">globals</span><span class="p">(),</span> <span class="n">namespace</span><span class="p">)</span>
<a id="__codelineno-72-15" name="__codelineno-72-15"></a>
<a id="__codelineno-72-16" name="__codelineno-72-16"></a><span class="c1"># Step 3: Create the final class object</span>
<a id="__codelineno-72-17" name="__codelineno-72-17"></a><span class="n">Account</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="s1">&#39;Account&#39;</span><span class="p">,</span> <span class="p">(),</span> <span class="n">namespace</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>In the definition process, there is interaction with the <code>type</code> class to create the class namespace and to create the final class object. The choice of using <code>type</code> can be customized - a class can choose to be processed by a different metaclass by specifying a different metaclass. This is done by using the <code>metaclass</code> keyword argument in inheritance:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-73-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1"></a><span class="k">class</span> <span class="nc">Account</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="nb">type</span><span class="p">):</span>
</code></pre></div></td></tr></table></div>
<p>If no metaclass is given, the <code>class</code> statement examines the type of the first entry in the tuple of base classes (if any) and uses that as the metaclass. Therefore, if you write <code>class Account(object)</code>, the resulting <code>Account</code> class will have the same type as <code>object</code> (which is <code>type</code>). Note that classes that don't specify any parent at all always inherit from <code>object</code>, so this still applies.</p>
<p>To create a new metaclass, define a class that inherits from <code>type</code>. Within this class, you can redefine one or more methods that are used during the class creation process. Typically, this includes the <code>__prepare__()</code> method used to create the class namespace, the <code>__new__()</code> method used to create the class instance, the <code>__init__()</code> method called after a class has already been created, and the <code>__call__()</code> method used to create new instances. The following example implements a metaclass that merely prints the input arguments to each method so you can experiment:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-74-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-74-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-74-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-74-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-74-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-74-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-74-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-74-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-74-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-74-10">10</a></span>
<span class="normal"><a href="#__codelineno-74-11">11</a></span>
<span class="normal"><a href="#__codelineno-74-12">12</a></span>
<span class="normal"><a href="#__codelineno-74-13">13</a></span>
<span class="normal"><a href="#__codelineno-74-14">14</a></span>
<span class="normal"><a href="#__codelineno-74-15">15</a></span>
<span class="normal"><a href="#__codelineno-74-16">16</a></span>
<span class="normal"><a href="#__codelineno-74-17">17</a></span>
<span class="normal"><a href="#__codelineno-74-18">18</a></span>
<span class="normal"><a href="#__codelineno-74-19">19</a></span>
<span class="normal"><a href="#__codelineno-74-20">20</a></span>
<span class="normal"><a href="#__codelineno-74-21">21</a></span>
<span class="normal"><a href="#__codelineno-74-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1"></a><span class="k">class</span> <span class="nc">mytype</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
<a id="__codelineno-74-2" name="__codelineno-74-2"></a>    <span class="c1"># Creates the class namespace</span>
<a id="__codelineno-74-3" name="__codelineno-74-3"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-74-4" name="__codelineno-74-4"></a>    <span class="k">def</span> <span class="fm">__prepare__</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">clsname</span><span class="p">,</span> <span class="n">bases</span><span class="p">):</span>
<a id="__codelineno-74-5" name="__codelineno-74-5"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Preparing:&#39;</span><span class="p">,</span> <span class="n">clsname</span><span class="p">,</span> <span class="n">bases</span><span class="p">)</span>
<a id="__codelineno-74-6" name="__codelineno-74-6"></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__prepare__</span><span class="p">(</span><span class="n">clsname</span><span class="p">,</span> <span class="n">bases</span><span class="p">)</span>
<a id="__codelineno-74-7" name="__codelineno-74-7"></a>
<a id="__codelineno-74-8" name="__codelineno-74-8"></a>    <span class="c1"># Creates the class instance after body has executed</span>
<a id="__codelineno-74-9" name="__codelineno-74-9"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-74-10" name="__codelineno-74-10"></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">clsname</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">):</span>
<a id="__codelineno-74-11" name="__codelineno-74-11"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Creating:&#39;</span><span class="p">,</span> <span class="n">clsname</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
<a id="__codelineno-74-12" name="__codelineno-74-12"></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">clsname</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
<a id="__codelineno-74-13" name="__codelineno-74-13"></a>
<a id="__codelineno-74-14" name="__codelineno-74-14"></a>    <span class="c1"># Initializes the class instance</span>
<a id="__codelineno-74-15" name="__codelineno-74-15"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">clsname</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">):</span>
<a id="__codelineno-74-16" name="__codelineno-74-16"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Initializing:&#39;</span><span class="p">,</span> <span class="n">clsname</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
<a id="__codelineno-74-17" name="__codelineno-74-17"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">clsname</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
<a id="__codelineno-74-18" name="__codelineno-74-18"></a>
<a id="__codelineno-74-19" name="__codelineno-74-19"></a>    <span class="c1"># Creates new instances of the class</span>
<a id="__codelineno-74-20" name="__codelineno-74-20"></a>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-74-21" name="__codelineno-74-21"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Creating instance:&#39;</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-74-22" name="__codelineno-74-22"></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h1 id="example_1">Example</h1>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-75-1">1</a></span>
<span class="normal"><a href="#__codelineno-75-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1"></a><span class="k">class</span> <span class="nc">Base</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">mytype</span><span class="p">):</span>
<a id="__codelineno-75-2" name="__codelineno-75-2"></a>    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
<p>The definition of the <code>Base</code> produces the following output:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-76-1">1</a></span>
<span class="normal"><a href="#__codelineno-76-2">2</a></span>
<span class="normal"><a href="#__codelineno-76-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1"></a># Preparing: Base ()
<a id="__codelineno-76-2" name="__codelineno-76-2"></a># Creating: Base () {&#39;__module__&#39;: &#39;__main__&#39;, &#39;__qualname__&#39;: &#39;Base&#39;}
<a id="__codelineno-76-3" name="__codelineno-76-3"></a># Initializing: Base () {&#39;__module__&#39;: &#39;__main__&#39;, &#39;__qualname__&#39;: &#39;Base&#39;}
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-77-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1"></a><span class="n">b</span> <span class="o">=</span> <span class="n">Base</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<p>Creating instance: <code>()</code>.</p>
<p>One tricky facet of working with metaclasses is the naming of variables and keeping track of the various entities involved. In the above code, the <code>meta</code> name refers to the metaclass itself. The <code>cls</code> name refers to a class instance created by the metaclass. Although not used here, the <code>self</code> name refers to a normal instance created by a class.</p>
<p>Metaclasses propagate via inheritance. So, if you've defined a base class to use a different metaclass, all child classes will also use that metaclass. Try this example to see your custom metaclass at work:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-78-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-78-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-78-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-78-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-78-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-78-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-78-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-78-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-78-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-78-10">10</a></span>
<span class="normal"><a href="#__codelineno-78-11">11</a></span>
<span class="normal"><a href="#__codelineno-78-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1"></a><span class="k">class</span> <span class="nc">Account</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<a id="__codelineno-78-2" name="__codelineno-78-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">balance</span><span class="p">):</span>
<a id="__codelineno-78-3" name="__codelineno-78-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">owner</span>
<a id="__codelineno-78-4" name="__codelineno-78-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">=</span> <span class="n">balance</span>
<a id="__codelineno-78-5" name="__codelineno-78-5"></a>
<a id="__codelineno-78-6" name="__codelineno-78-6"></a>    <span class="k">def</span> <span class="nf">deposit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
<a id="__codelineno-78-7" name="__codelineno-78-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">+=</span> <span class="n">amount</span>
<a id="__codelineno-78-8" name="__codelineno-78-8"></a>
<a id="__codelineno-78-9" name="__codelineno-78-9"></a>    <span class="k">def</span> <span class="nf">withdraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
<a id="__codelineno-78-10" name="__codelineno-78-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">-=</span> <span class="n">amount</span>
<a id="__codelineno-78-11" name="__codelineno-78-11"></a>
<a id="__codelineno-78-12" name="__codelineno-78-12"></a><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Account</span><span class="p">))</span>   <span class="c1"># -&gt; &lt;class &#39;mytype&#39;&gt;</span>
</code></pre></div></td></tr></table></div>
<p>The primary use of metaclasses is in situations where you want to exert extreme low-level control over the class definition environment and creation process. Before proceeding, however, remember that Python already provides a lot of functionality for monitoring and altering class definitions (such as the <code>__init_subclass__()</code> method, class decorators, descriptors, mixins, and so on). Most of the time, you probably don't need a metaclass. That said, the next few examples show situations where a metaclass provides the only sensible solution.</p>
<p>One use of a metaclass is in rewriting the contents of the class namespace prior to the creation of the class object. Certain features of classes are established at definition time and can't be modified later. One such feature is <code>__slots__</code>. As noted earlier, <code>__slots__</code> is a performance optimization related to the memory layout of instances. Here's a metaclass that automatically sets the <code>__slots__</code> attribute based on the calling signature of the <code>__init__()</code> method.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-79-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-79-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-79-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-79-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-79-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-79-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-79-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-79-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-79-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-79-10">10</a></span>
<span class="normal"><a href="#__codelineno-79-11">11</a></span>
<span class="normal"><a href="#__codelineno-79-12">12</a></span>
<span class="normal"><a href="#__codelineno-79-13">13</a></span>
<span class="normal"><a href="#__codelineno-79-14">14</a></span>
<span class="normal"><a href="#__codelineno-79-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1"></a><span class="kn">import</span> <span class="nn">inspect</span>
<a id="__codelineno-79-2" name="__codelineno-79-2"></a>
<a id="__codelineno-79-3" name="__codelineno-79-3"></a><span class="k">class</span> <span class="nc">SlotMeta</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
<a id="__codelineno-79-4" name="__codelineno-79-4"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-79-5" name="__codelineno-79-5"></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">clsname</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">methods</span><span class="p">):</span>
<a id="__codelineno-79-6" name="__codelineno-79-6"></a>        <span class="k">if</span> <span class="s1">&#39;__init__&#39;</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
<a id="__codelineno-79-7" name="__codelineno-79-7"></a>            <span class="n">sig</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">methods</span><span class="p">[</span><span class="s1">&#39;__init__&#39;</span><span class="p">])</span>
<a id="__codelineno-79-8" name="__codelineno-79-8"></a>            <span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">sig</span><span class="o">.</span><span class="n">parameters</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
<a id="__codelineno-79-9" name="__codelineno-79-9"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-79-10" name="__codelineno-79-10"></a>            <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>
<a id="__codelineno-79-11" name="__codelineno-79-11"></a>        <span class="n">methods</span><span class="p">[</span><span class="s1">&#39;__slots__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="vm">__slots__</span>
<a id="__codelineno-79-12" name="__codelineno-79-12"></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">clsname</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">methods</span><span class="p">)</span>
<a id="__codelineno-79-13" name="__codelineno-79-13"></a>
<a id="__codelineno-79-14" name="__codelineno-79-14"></a><span class="k">class</span> <span class="nc">Base</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">SlotMeta</span><span class="p">):</span>
<a id="__codelineno-79-15" name="__codelineno-79-15"></a>    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
<h1 id="example_2">Example</h1>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-80-1">1</a></span>
<span class="normal"><a href="#__codelineno-80-2">2</a></span>
<span class="normal"><a href="#__codelineno-80-3">3</a></span>
<span class="normal"><a href="#__codelineno-80-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1"></a><span class="k">class</span> <span class="nc">Point</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<a id="__codelineno-80-2" name="__codelineno-80-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<a id="__codelineno-80-3" name="__codelineno-80-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
<a id="__codelineno-80-4" name="__codelineno-80-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
</code></pre></div></td></tr></table></div>
<p>In this example, the <code>Point</code> class that's created is automatically created with slots of <code>('x', 'y')</code>. The resulting instances of <code>Point</code> now get memory savings without knowing that slots are being used. It doesn't have to be specified directly. This kind of trick is not possible with class decorators or with <code>init_subclass()</code> because those features only operate on a class after it's been created. By then, it's too late to apply the slots optimization.</p>
<p>Another use of metaclasses is for altering the class definition environment. For example, duplicate definitions of a name during class definition normally result in a silent error - the second definition overwrites the first. Suppose you wanted to catch that. Here's a metaclass that does that by defining a different kind of dictionary for the class namespace:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-81-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-81-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-81-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-81-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-81-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-81-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-81-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-81-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-81-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-81-10">10</a></span>
<span class="normal"><a href="#__codelineno-81-11">11</a></span>
<span class="normal"><a href="#__codelineno-81-12">12</a></span>
<span class="normal"><a href="#__codelineno-81-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1"></a><span class="k">class</span> <span class="nc">NoDupeDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-81-2" name="__codelineno-81-2"></a>    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<a id="__codelineno-81-3" name="__codelineno-81-3"></a>        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
<a id="__codelineno-81-4" name="__codelineno-81-4"></a>            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1"> already defined&#39;</span><span class="p">)</span>
<a id="__codelineno-81-5" name="__codelineno-81-5"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<a id="__codelineno-81-6" name="__codelineno-81-6"></a>
<a id="__codelineno-81-7" name="__codelineno-81-7"></a><span class="k">class</span> <span class="nc">NoDupeMeta</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
<a id="__codelineno-81-8" name="__codelineno-81-8"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-81-9" name="__codelineno-81-9"></a>    <span class="k">def</span> <span class="fm">__prepare__</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">clsname</span><span class="p">,</span> <span class="n">bases</span><span class="p">):</span>
<a id="__codelineno-81-10" name="__codelineno-81-10"></a>        <span class="k">return</span> <span class="n">NoDupeDict</span><span class="p">()</span>
<a id="__codelineno-81-11" name="__codelineno-81-11"></a>
<a id="__codelineno-81-12" name="__codelineno-81-12"></a><span class="k">class</span> <span class="nc">Base</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">NoDupeMeta</span><span class="p">):</span>
<a id="__codelineno-81-13" name="__codelineno-81-13"></a>    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
<h1 id="example_3">Example</h1>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-82-1">1</a></span>
<span class="normal"><a href="#__codelineno-82-2">2</a></span>
<span class="normal"><a href="#__codelineno-82-3">3</a></span>
<span class="normal"><a href="#__codelineno-82-4">4</a></span>
<span class="normal"><a href="#__codelineno-82-5">5</a></span>
<span class="normal"><a href="#__codelineno-82-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1"></a><span class="k">class</span> <span class="nc">SomeClass</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<a id="__codelineno-82-2" name="__codelineno-82-2"></a>    <span class="k">def</span> <span class="nf">yow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-82-3" name="__codelineno-82-3"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Yow!&#39;</span><span class="p">)</span>
<a id="__codelineno-82-4" name="__codelineno-82-4"></a>
<a id="__codelineno-82-5" name="__codelineno-82-5"></a>    <span class="k">def</span> <span class="nf">yow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>             <span class="c1"># Fails. Already defined</span>
<a id="__codelineno-82-6" name="__codelineno-82-6"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Different Yow!&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>This is only a small sample of what's possible. For framework builders, metaclasses offer an opportunity to tightly control what happens during class definition - allowing classes to serve as a kind of domain-specific language.</p>
<p>Historically, metaclasses have been used to accomplish a variety of tasks that are now possible through other means. The <code>init_subclass()</code> method, in particular, can be used to address a wide variety of use cases where metaclasses were once applied. This includes registration of classes with a central registry, automatic decoration of methods, and code generation.</p>
<h2 id="built-in-objects-for-instances-and-classes">Built-in Objects for Instances and Classes</h2>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>cls.__name__</code></td>
<td>Class name</td>
</tr>
<tr>
<td><code>cls.__module__</code></td>
<td>Module name in which the class is defined</td>
</tr>
<tr>
<td><code>cls.__qualname__</code></td>
<td>Fully qualified class name</td>
</tr>
<tr>
<td><code>cls.__bases__</code></td>
<td>Tuple of base classes</td>
</tr>
<tr>
<td><code>cls.__mro__</code></td>
<td>Method Resolution Order tuple</td>
</tr>
<tr>
<td><code>cls.__dict__</code></td>
<td>Dictionary holding class methods and variables</td>
</tr>
<tr>
<td><code>cls.__doc__</code></td>
<td>Documentation string</td>
</tr>
<tr>
<td><code>cls.__annotations__</code></td>
<td>Dictionary of class type hints</td>
</tr>
<tr>
<td><code>cls.__abstractmethods__</code></td>
<td>Set of abstract method names (may be undefined if there aren't any)</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>i.__class__</code></td>
<td>Class to which the instance belongs</td>
</tr>
<tr>
<td><code>i.__dict__</code></td>
<td>Dictionary holding instance data (if defined)</td>
</tr>
</tbody>
</table></p>
    </article>
</section>
            <!-- endblock -->

            <!-- block footer -->
                <footer>
    <div class="d-flex flex-sm-row justify-content-between py-2 border-top drac-text-black drac-bg-cyan-green">
        <a href="https://github.com/dracula/mkdocs" target="_blank" style="padding-left: 1%;"
            class="footer-text drac-anchor drac-text-black drac-text-purple--hover">
            Made with Dracula Theme for MkDocs
        </a>
    </div>
</footer>
            <!-- endblock -->
        </div>

    </main>

        <script>var base_url = '../../..';</script>
        <script src="../../../assets/js/jquery-3.3.1.slim.min.js""></script>
        <script src="../../../assets/js/bootstrap.bundle.min.js""></script>
        <script src="../../../assets/js/mkdocs.js""></script>
			<script src="../../../search/main.js" defer></script>

</body>

</html>
